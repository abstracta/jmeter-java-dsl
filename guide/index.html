<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.64">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="shortcut icon" href="/jmeter-java-dsl/favicon.ico"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                    })(window,document,'script','dataLayer','GTM-PHSGKLD');
                    </script><title>User guide | jmeter-java-dsl</title><meta name="description" content="Simple JMeter performance tests API">
    <link rel="preload" href="/jmeter-java-dsl/assets/style-f6cdd56f.css" as="style"><link rel="stylesheet" href="/jmeter-java-dsl/assets/style-f6cdd56f.css">
    <link rel="modulepreload" href="/jmeter-java-dsl/assets/app-0b55935c.js"><link rel="modulepreload" href="/jmeter-java-dsl/assets/index.html-1a7d1c6e.js"><link rel="modulepreload" href="/jmeter-java-dsl/assets/index.html-7dfcd2d6.js"><link rel="prefetch" href="/jmeter-java-dsl/assets/index.html-a099ade6.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/testimonials.html-96ecbae2.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/index.html-0e290538.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/index.html-20640c9f.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/index.html-0cd27eb4.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/testimonials.html-015a0565.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/index.html-1e95ee7c.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/index.html-438767f2.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/404.html-ca933fde.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/Carousel-da860e65.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/Testimonial-f5fe13a8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><!--[--><a href="/jmeter-java-dsl/" class=""><img class="logo" src="/jmeter-java-dsl/logo.svg" alt="jmeter-java-dsl" style="margin-right:0;"><span style="font-size:1.6rem;"> .java</span><!-- Stripped site title from original theme --></a><hr class="vertical-divider"><a class="external-link" href="https://abstracta.github.io/jmeter-dotnet-dsl" rel="noopener noreferrer" target="_blank" aria-label=".net" style="font-size:1.6rem;color:#a502ce;"><!--[--><!--]--><span><!----> .net</span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!--]--></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a aria-current="page" href="/jmeter-java-dsl/guide/" class="router-link-active router-link-exact-active router-link-active" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/jmeter-java-dsl/support/" class="" aria-label="Support"><!--[--><!--]--> Support <!--[--><!--]--></a></div><div class="navbar-item"><a href="/jmeter-java-dsl/motivation/" class="" aria-label="Motivation"><!--[--><!--]--> Motivation <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://discord.gg/WNSn5hqmSd" rel="noopener noreferrer" target="_blank" aria-label style=""><!--[--><!--]--><span><!----> </span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/abstracta/jmeter-java-dsl" rel="noopener noreferrer" target="_blank" aria-label style=""><!--[--><!--]--><span><!----> </span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a aria-current="page" href="/jmeter-java-dsl/guide/" class="router-link-active router-link-exact-active router-link-active" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/jmeter-java-dsl/support/" class="" aria-label="Support"><!--[--><!--]--> Support <!--[--><!--]--></a></div><div class="navbar-item"><a href="/jmeter-java-dsl/motivation/" class="" aria-label="Motivation"><!--[--><!--]--> Motivation <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://discord.gg/WNSn5hqmSd" rel="noopener noreferrer" target="_blank" aria-label style=""><!--[--><!--]--><span><!----> </span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/abstracta/jmeter-java-dsl" rel="noopener noreferrer" target="_blank" aria-label style=""><!--[--><!--]--><span><!----> </span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">User guide <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#setup" class="router-link-active router-link-exact-active sidebar-item" aria-label="Setup"><!--[--><!--]--> Setup <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#simple-http-test-plan" class="router-link-active router-link-exact-active sidebar-item" aria-label="Simple HTTP test plan"><!--[--><!--]--> Simple HTTP test plan <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#dsl-recorder" class="router-link-active router-link-exact-active sidebar-item" aria-label="DSL recorder"><!--[--><!--]--> DSL recorder <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#correlations" class="router-link-active router-link-exact-active sidebar-item" aria-label="Correlations"><!--[--><!--]--> Correlations <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#dsl-code-generation-from-jmx-file" class="router-link-active router-link-exact-active sidebar-item" aria-label="DSL code generation from JMX file"><!--[--><!--]--> DSL code generation from JMX file <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#run-test-at-scale" class="router-link-active router-link-exact-active sidebar-item" aria-label="Run test at scale"><!--[--><!--]--> Run test at scale <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#blazemeter" class="router-link-active router-link-exact-active sidebar-item" aria-label="BlazeMeter"><!--[--><!--]--> BlazeMeter <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#octoperf" class="router-link-active router-link-exact-active sidebar-item" aria-label="OctoPerf"><!--[--><!--]--> OctoPerf <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#azure-load-testing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Azure Load Testing"><!--[--><!--]--> Azure Load Testing <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#jmeter-remote-testing" class="router-link-active router-link-exact-active sidebar-item" aria-label="JMeter remote testing"><!--[--><!--]--> JMeter remote testing <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#auto-stop" class="router-link-active router-link-exact-active sidebar-item" aria-label="Auto Stop"><!--[--><!--]--> Auto Stop <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#advanced-threads-configuration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Advanced threads configuration"><!--[--><!--]--> Advanced threads configuration <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#thread-ramps-and-holds" class="router-link-active router-link-exact-active sidebar-item" aria-label="Thread ramps and holds"><!--[--><!--]--> Thread ramps and holds <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#throughput-based-thread-group" class="router-link-active router-link-exact-active sidebar-item" aria-label="Throughput based thread group"><!--[--><!--]--> Throughput based thread group <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#set-up-tear-down" class="router-link-active router-link-exact-active sidebar-item" aria-label="Set up &amp; tear down"><!--[--><!--]--> Set up &amp; tear down <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#thread-groups-order" class="router-link-active router-link-exact-active sidebar-item" aria-label="Thread groups order"><!--[--><!--]--> Thread groups order <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#test-plan-debugging" class="router-link-active router-link-exact-active sidebar-item" aria-label="Test plan debugging"><!--[--><!--]--> Test plan debugging <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#view-results-tree" class="router-link-active router-link-exact-active sidebar-item" aria-label="View results tree"><!--[--><!--]--> View results tree <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#post-processor-breakpoints" class="router-link-active router-link-exact-active sidebar-item" aria-label="Post-processor breakpoints"><!--[--><!--]--> Post-processor breakpoints <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#debug-info-during-test-plan-execution" class="router-link-active router-link-exact-active sidebar-item" aria-label="Debug info during test plan execution"><!--[--><!--]--> Debug info during test plan execution <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#debug-jmeter-code" class="router-link-active router-link-exact-active sidebar-item" aria-label="Debug JMeter code"><!--[--><!--]--> Debug JMeter code <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#debug-groovy-code" class="router-link-active router-link-exact-active sidebar-item" aria-label="Debug Groovy code"><!--[--><!--]--> Debug Groovy code <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#dummy-sampler" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dummy sampler"><!--[--><!--]--> Dummy sampler <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#test-plan-review-in-jmeter-gui" class="router-link-active router-link-exact-active sidebar-item" aria-label="Test plan review in JMeter GUI"><!--[--><!--]--> Test plan review in JMeter GUI <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#reporting" class="router-link-active router-link-exact-active sidebar-item" aria-label="Reporting"><!--[--><!--]--> Reporting <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#log-requests-and-responses" class="router-link-active router-link-exact-active sidebar-item" aria-label="Log requests and responses"><!--[--><!--]--> Log requests and responses <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#real-time-metrics-visualization-and-historic-data-storage" class="router-link-active router-link-exact-active sidebar-item" aria-label="Real-time metrics visualization and historic data storage"><!--[--><!--]--> Real-time metrics visualization and historic data storage <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#influxdb" class="router-link-active router-link-exact-active sidebar-item" aria-label="InfluxDB"><!--[--><!--]--> InfluxDB <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#graphite" class="router-link-active router-link-exact-active sidebar-item" aria-label="Graphite"><!--[--><!--]--> Graphite <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#elasticsearch" class="router-link-active router-link-exact-active sidebar-item" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#prometheus" class="router-link-active router-link-exact-active sidebar-item" aria-label="Prometheus"><!--[--><!--]--> Prometheus <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#datadog" class="router-link-active router-link-exact-active sidebar-item" aria-label="DataDog"><!--[--><!--]--> DataDog <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#generate-html-reports-from-test-plan-execution" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generate HTML reports from test plan execution"><!--[--><!--]--> Generate HTML reports from test plan execution <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#live-built-in-graphs-and-stats" class="router-link-active router-link-exact-active sidebar-item" aria-label="Live built-in graphs and stats"><!--[--><!--]--> Live built-in graphs and stats <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#response-processing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Response processing"><!--[--><!--]--> Response processing <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#check-for-expected-response" class="router-link-active router-link-exact-active sidebar-item" aria-label="Check for expected response"><!--[--><!--]--> Check for expected response <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#check-for-expected-json" class="router-link-active router-link-exact-active sidebar-item" aria-label="Check for expected JSON"><!--[--><!--]--> Check for expected JSON <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#change-sample-result-statuses-with-custom-logic" class="router-link-active router-link-exact-active sidebar-item" aria-label="Change sample result statuses with custom logic"><!--[--><!--]--> Change sample result statuses with custom logic <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#lambdas" class="router-link-active router-link-exact-active sidebar-item" aria-label="Lambdas"><!--[--><!--]--> Lambdas <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#use-part-of-a-response-in-a-subsequent-request-aka-correlation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Use part of a response in a subsequent request (aka correlation)"><!--[--><!--]--> Use part of a response in a subsequent request (aka correlation) <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#regular-expressions-extraction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Regular expressions extraction"><!--[--><!--]--> Regular expressions extraction <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#boundaries-based-extraction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Boundaries based extraction"><!--[--><!--]--> Boundaries based extraction <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#json-extraction" class="router-link-active router-link-exact-active sidebar-item" aria-label="JSON extraction"><!--[--><!--]--> JSON extraction <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#requests-generation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Requests generation"><!--[--><!--]--> Requests generation <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#conditionals" class="router-link-active router-link-exact-active sidebar-item" aria-label="Conditionals"><!--[--><!--]--> Conditionals <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#loops" class="router-link-active router-link-exact-active sidebar-item" aria-label="Loops"><!--[--><!--]--> Loops <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#iterating-over-extracted-values" class="router-link-active router-link-exact-active sidebar-item" aria-label="Iterating over extracted values"><!--[--><!--]--> Iterating over extracted values <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#iterating-while-a-condition-is-met" class="router-link-active router-link-exact-active sidebar-item" aria-label="Iterating while a condition is met"><!--[--><!--]--> Iterating while a condition is met <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#iterating-a-fixed-number-of-times" class="router-link-active router-link-exact-active sidebar-item" aria-label="Iterating a fixed number of times"><!--[--><!--]--> Iterating a fixed number of times <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#iterating-for-a-given-period" class="router-link-active router-link-exact-active sidebar-item" aria-label="Iterating for a given period"><!--[--><!--]--> Iterating for a given period <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#execute-only-once-in-thread" class="router-link-active router-link-exact-active sidebar-item" aria-label="Execute only once in thread"><!--[--><!--]--> Execute only once in thread <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#group-requests" class="router-link-active router-link-exact-active sidebar-item" aria-label="Group requests"><!--[--><!--]--> Group requests <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#csv-as-input-data-for-requests" class="router-link-active router-link-exact-active sidebar-item" aria-label="CSV as input data for requests"><!--[--><!--]--> CSV as input data for requests <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#counter" class="router-link-active router-link-exact-active sidebar-item" aria-label="Counter"><!--[--><!--]--> Counter <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#provide-request-parameters-programmatically-per-request" class="router-link-active router-link-exact-active sidebar-item" aria-label="Provide request parameters programmatically per request"><!--[--><!--]--> Provide request parameters programmatically per request <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#timers" class="router-link-active router-link-exact-active sidebar-item" aria-label="Timers"><!--[--><!--]--> Timers <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#emulate-user-delays-between-requests" class="router-link-active router-link-exact-active sidebar-item" aria-label="Emulate user delays between requests"><!--[--><!--]--> Emulate user delays between requests <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#control-throughput" class="router-link-active router-link-exact-active sidebar-item" aria-label="Control throughput"><!--[--><!--]--> Control throughput <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#requests-synchronization" class="router-link-active router-link-exact-active sidebar-item" aria-label="Requests synchronization"><!--[--><!--]--> Requests synchronization <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#execute-part-of-a-test-plan-part-a-fraction-of-the-times" class="router-link-active router-link-exact-active sidebar-item" aria-label="Execute part of a test plan part a fraction of the times"><!--[--><!--]--> Execute part of a test plan part a fraction of the times <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#switch-between-test-plan-parts-with-a-given-probability" class="router-link-active router-link-exact-active sidebar-item" aria-label="Switch between test plan parts with a given probability"><!--[--><!--]--> Switch between test plan parts with a given probability <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#parallel-requests" class="router-link-active router-link-exact-active sidebar-item" aria-label="Parallel requests"><!--[--><!--]--> Parallel requests <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#jmeter-variables-properties" class="router-link-active router-link-exact-active sidebar-item" aria-label="JMeter variables &amp; properties"><!--[--><!--]--> JMeter variables &amp; properties <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#variables" class="router-link-active router-link-exact-active sidebar-item" aria-label="Variables"><!--[--><!--]--> Variables <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#properties" class="router-link-active router-link-exact-active sidebar-item" aria-label="Properties"><!--[--><!--]--> Properties <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#test-resources" class="router-link-active router-link-exact-active sidebar-item" aria-label="Test resources"><!--[--><!--]--> Test resources <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#protocols" class="router-link-active router-link-exact-active sidebar-item" aria-label="Protocols"><!--[--><!--]--> Protocols <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#http" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#methods-body" class="router-link-active router-link-exact-active sidebar-item" aria-label="Methods &amp; body"><!--[--><!--]--> Methods &amp; body <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#parameters" class="router-link-active router-link-exact-active sidebar-item" aria-label="Parameters"><!--[--><!--]--> Parameters <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#headers" class="router-link-active router-link-exact-active sidebar-item" aria-label="Headers"><!--[--><!--]--> Headers <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#authentication" class="router-link-active router-link-exact-active sidebar-item" aria-label="Authentication"><!--[--><!--]--> Authentication <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#multipart-requests" class="router-link-active router-link-exact-active sidebar-item" aria-label="Multipart requests"><!--[--><!--]--> Multipart requests <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#cookies-caching" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cookies &amp; caching"><!--[--><!--]--> Cookies &amp; caching <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#timeouts" class="router-link-active router-link-exact-active sidebar-item" aria-label="Timeouts"><!--[--><!--]--> Timeouts <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#connections" class="router-link-active router-link-exact-active sidebar-item" aria-label="Connections"><!--[--><!--]--> Connections <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#embedded-resources" class="router-link-active router-link-exact-active sidebar-item" aria-label="Embedded resources"><!--[--><!--]--> Embedded resources <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#redirects" class="router-link-active router-link-exact-active sidebar-item" aria-label="Redirects"><!--[--><!--]--> Redirects <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#keep-alive" class="router-link-active router-link-exact-active sidebar-item" aria-label="Keep alive"><!--[--><!--]--> Keep alive <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#http-defaults" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP defaults"><!--[--><!--]--> HTTP defaults <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#overriding-url-protocol-host-or-port" class="router-link-active router-link-exact-active sidebar-item" aria-label="Overriding URL protocol, host or port"><!--[--><!--]--> Overriding URL protocol, host or port <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#proxy" class="router-link-active router-link-exact-active sidebar-item" aria-label="Proxy"><!--[--><!--]--> Proxy <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#graphql" class="router-link-active router-link-exact-active sidebar-item" aria-label="GraphQL"><!--[--><!--]--> GraphQL <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#jdbc-and-databases-interactions" class="router-link-active router-link-exact-active sidebar-item" aria-label="JDBC and databases interactions"><!--[--><!--]--> JDBC and databases interactions <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#java-api-performance-testing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Java API performance testing"><!--[--><!--]--> Java API performance testing <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#selenium" class="router-link-active router-link-exact-active sidebar-item" aria-label="Selenium"><!--[--><!--]--> Selenium <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#custom-or-yet-not-supported-test-elements" class="router-link-active router-link-exact-active sidebar-item" aria-label="Custom or yet not supported test elements"><!--[--><!--]--> Custom or yet not supported test elements <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#jmx-support" class="router-link-active router-link-exact-active sidebar-item" aria-label="JMX support"><!--[--><!--]--> JMX support <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/jmeter-java-dsl/guide/#save-as-jmx" class="router-link-active router-link-exact-active sidebar-item" aria-label="Save as JMX"><!--[--><!--]--> Save as JMX <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/jmeter-java-dsl/guide/#run-jmx-file" class="router-link-active router-link-exact-active sidebar-item" aria-label="Run JMX file"><!--[--><!--]--> Run JMX file <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="user-guide" tabindex="-1"><a class="header-anchor" href="#user-guide" aria-hidden="true">#</a> User guide</h1><p>Here we share some tips and examples on how to use the DSL to tackle common use cases.</p><p>Provided examples use <a href="https://junit.org/junit5/" target="_blank" rel="noopener noreferrer">JUnit 5<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://joel-costigliola.github.io/assertj/assertj-core-quick-start.html" target="_blank" rel="noopener noreferrer">AssertJ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, but you can use other test &amp; assertion libraries.</p><p>Explore the DSL in your preferred IDE to discover all available features, and consider reviewing <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/test/java/us/abstracta/jmeter/javadsl" target="_blank" rel="noopener noreferrer">existing tests<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional examples.</p><p>The DSL currently supports most common used cases, keeping it simple and avoiding investing development effort in features that might not be needed. If you identify any particular scenario (or JMeter feature) that you need and is not currently supported, or easy to use, <strong>please let us know by <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">creating an issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong> and we will try to implement it as soon as possible. Usually porting JMeter features is quite fast.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you like this project, <strong>please give it a star ⭐ in <a href="https://github.com/abstracta/jmeter-java-dsl" target="_blank" rel="noopener noreferrer">GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>!</strong> This helps the project be more visible, gain relevance, and encourages us to invest more effort in new features.</p></div><p>For an intro to JMeter concepts and components, you can check <a href="http://jmeter.apache.org/usermanual/get-started.html" target="_blank" rel="noopener noreferrer">JMeter official documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h2 id="setup" tabindex="-1"><a class="header-anchor" href="#setup" aria-hidden="true">#</a> Setup</h2><p>To use the DSL just include it in your project:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code><span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;us.abstracta.jmeter:jmeter-java-dsl:2.1&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;org.apache.jmeter&quot;</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">&quot;bom&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><a href="https://github.com/abstracta/jmeter-java-dsl-sample" target="_blank" rel="noopener noreferrer">Here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is a sample project in case you want to start one from scratch.</p></div><h2 id="simple-http-test-plan" tabindex="-1"><a class="header-anchor" href="#simple-http-test-plan" aria-hidden="true">#</a> Simple HTTP test plan</h2><p>To generate HTTP requests just use provided <code>httpSampler</code>.</p><p>The following example uses 2 threads (concurrent users) that send 10 HTTP GET requests each to <code>http://my.service</code>.</p><p>Additionally, it logs collected statistics (response times, status codes, etc.) to a file (for later analysis if needed) and checks that the response time 99 percentile is less than 5 seconds.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//this is just to log details of each request stats</span>
        <span class="token function">jtlWriter</span><span class="token punctuation">(</span><span class="token string">&quot;target/jtls&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When working with multiple samplers in a test plan, specify their names (eg: <code>httpSampler(&quot;home&quot;, &quot;http://my.service&quot;)</code>) to easily check their respective statistics.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Set connection and response timeouts to avoid potential execution differences when running test plan in different machines. <a href="#timeouts">Here</a> are more details.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Since JMeter uses <a href="https://logging.apache.org/log4j/2.x/" target="_blank" rel="noopener noreferrer">log4j2<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, if you want to control the logging level or output, you can use something similar to this <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/test/resources/log4j2.xml" target="_blank" rel="noopener noreferrer">log4j2.xml<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Keep in mind that you can use Java programming to modularize and create abstractions which allow you to build complex test plans that are still easy to read, use and maintain. <a href="https://github.com/abstracta/jmeter-java-dsl/issues/26#issuecomment-953783407" target="_blank" rel="noopener noreferrer">Here is an example<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> of some complex abstraction built using Java features and the DSL.</p></div><p>Check <a href="#http">HTTP performance testing</a> for additional details while testing HTTP services.</p><h2 id="dsl-recorder" tabindex="-1"><a class="header-anchor" href="#dsl-recorder" aria-hidden="true">#</a> DSL recorder</h2><p>When creating test plans you can rely just on the IDE or you can use provided recorder.</p><p>Here is a small demo using it:</p><p><img src="/jmeter-java-dsl/assets/jmdsl-recorder-7b4503f7.gif" alt="jmdsl recorder demo"></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can use <a href="https://www.jbang.dev/documentation/guide/latest/index.html" target="_blank" rel="noopener noreferrer">jbang<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to easily execute the recorder with the latest version available. E.g.:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>jbang us.abstracta.jmeter:jmeter-java-dsl-cli:2.1 recorder http://retailstore.test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Use <code>java -jar jmdsl.jar help recorder</code> to see the list of options to customize your recording.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>In general use <code>---url-includes</code> to ignore URLs that are not relevant to the performance test.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Unlike the rest of JMeter DSL, which is compiled with Java 8, <code>jmdsl.jar</code> and <code>us.abstracta.jmeter:jmeter-java-dsl-cli</code> are compiled with Java 11 due to some dependencies requirement (latest Selenium drivers mainly).</p><p>So, to run above commands, you will need Java 11 or newer.</p></div><h3 id="correlations" tabindex="-1"><a class="header-anchor" href="#correlations" aria-hidden="true">#</a> Correlations</h3><p>To avoid fragile test plans with fixed values in request parameters, the DSL recorder, through the usage of the <a href="https://github.com/Blazemeter/CorrelationRecorder" target="_blank" rel="noopener noreferrer">JMeter Correlation Recorder Plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, allows you to define correlation rules.</p><p>Correlation rules define regular expressions, which allow the recorder to automatically add <code>regexExtractor</code> and replace occurrences of extracted values in following requests with proper variable references.</p><p>For example, for the same scenario previously shown, and using <code>--config</code> option (which makes correlation rules easier to maintain) with following file:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">recorder</span><span class="token punctuation">:</span>
  <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//retailstore.test
  <span class="token key atrule">urlIncludes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> retailstore.test.*
  <span class="token key atrule">correlations</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">variable</span><span class="token punctuation">:</span> productId
      <span class="token key atrule">extractor</span><span class="token punctuation">:</span> name=&quot;productId&quot; value=&quot;(<span class="token punctuation">[</span>^&quot;<span class="token punctuation">]</span>+)&quot;
      <span class="token key atrule">replacement</span><span class="token punctuation">:</span> productId=(.<span class="token important">*)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We get this test plan:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">///usr/bin/env jbang &quot;$0&quot; &quot;$@&quot; ; exit $?</span>
<span class="token comment">/*
These commented lines make the class executable if you have jbang installed by making the file
executable (eg: chmod +x ./PerformanceTest.java) and just executing it with ./PerformanceTest.java
*/</span>
<span class="token comment">//DEPS org.assertj:assertj-core:3.23.1</span>
<span class="token comment">//DEPS org.junit.jupiter:junit-jupiter-engine:5.9.1</span>
<span class="token comment">//DEPS org.junit.platform:junit-platform-launcher:1.9.1</span>
<span class="token comment">//DEPS us.abstracta.jmeter:jmeter-java-dsl:2.1</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HTTPConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">DiscoverySelectors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LauncherDiscoveryRequestBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LauncherFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span></span><span class="token class-name">SummaryGeneratingListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span></span><span class="token class-name">TestExecutionSummary</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/-1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://retailstore.test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/home-3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://retailstore.test/home&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
              <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;productId#2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name=\&quot;productId\&quot; value=\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;productId#2_NOT_FOUND&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/cart-16&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://retailstore.test/cart&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_FORM_URLENCODED</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">rawParam</span><span class="token punctuation">(</span><span class="token string">&quot;productId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;${productId#2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/cart-17&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://retailstore.test/cart&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">errorsCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   This method is only included to make the test class self-executable. You can remove it when
   executing tests with maven, gradle, or some other tool.
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SummaryGeneratingListener</span> summaryListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SummaryGeneratingListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LauncherFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">LauncherDiscoveryRequestBuilder</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">selectors</span><span class="token punctuation">(</span><span class="token class-name">DiscoverySelectors</span><span class="token punctuation">.</span><span class="token function">selectClass</span><span class="token punctuation">(</span><span class="token class-name">PerformanceTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            summaryListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TestExecutionSummary</span> summary <span class="token operator">=</span> summaryListener<span class="token punctuation">.</span><span class="token function">getSummary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    summary<span class="token punctuation">.</span><span class="token function">printFailuresTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>summary<span class="token punctuation">.</span><span class="token function">getTotalFailureCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this test plan you can see an already added an extractor and the usage of extracted value in a subsequent request (as a variable reference).</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>To identify potential correlations, you can check in request parameters or URLs with fixed values and then, check the automatically created recording <code>.jtl</code> file (by default in <code>target/recording</code> folder) to identify proper regular expression for extraction.</p><p>We have ideas to ease this for the future, but, if you have ideas, or just want to give more priority to improving this, please create an <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">issue in the repository<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to let us know.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When using <code>--config</code>, take advantage of your IDEs auto-completion and inline documentation capabilities by using <code>.jmdsl.yml</code> suffix in config file names.</p><p>Here is a screenshot of autocompletion in action:</p><p><img src="/jmeter-java-dsl/assets/config-ide-autocomplete-230365f9.png" alt="Config file IDE autocomplete"></p></div><h2 id="dsl-code-generation-from-jmx-file" tabindex="-1"><a class="header-anchor" href="#dsl-code-generation-from-jmx-file" aria-hidden="true">#</a> DSL code generation from JMX file</h2><p>To ease migrating existing JMeter test plans and ease learning about DSL features, the DSL provides <code>jmx2dsl</code> cli command (download the latest cli version from <a href="https://github.com/abstracta/jmeter-java-dsl/releases" target="_blank" rel="noopener noreferrer">releases page<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> or use <a href="https://www.jbang.dev/documentation/guide/latest/index.html" target="_blank" rel="noopener noreferrer">jbang<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>) command line tool which you can use to generate DSL code from existing JMX files.</p><p>As an example:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Java</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Jbang</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> jmdsl.jar jmx2dsl test-plan.jmx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>jbang us.abstracta.jmeter:jmeter-java-dsl-cli:2.1 jmx2dsl test-plan.jmx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Could generate something like the following output:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">///usr/bin/env jbang &quot;$0&quot; &quot;$@&quot; ; exit $?</span>
<span class="token comment">/*
These commented lines make the class executable if you have jbang installed by making the file
executable (eg: chmod +x ./PerformanceTest.java) and just executing it with ./PerformanceTest.java
*/</span>
<span class="token comment">//DEPS org.assertj:assertj-core:3.23.1</span>
<span class="token comment">//DEPS org.junit.jupiter:junit-jupiter-engine:5.9.1</span>
<span class="token comment">//DEPS org.junit.platform:junit-platform-launcher:1.9.1</span>
<span class="token comment">//DEPS us.abstracta.jmeter:jmeter-java-dsl:2.1</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">DiscoverySelectors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LauncherDiscoveryRequestBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LauncherFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span></span><span class="token class-name">SummaryGeneratingListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>launcher<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span></span><span class="token class-name">TestExecutionSummary</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">jtlWriter</span><span class="token punctuation">(</span><span class="token string">&quot;target/jtls&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">errorsCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   This method is only included to make the test class self-executable. You can remove it when
   executing tests with maven, gradle, or some other tool.
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SummaryGeneratingListener</span> summaryListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SummaryGeneratingListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LauncherFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">LauncherDiscoveryRequestBuilder</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">selectors</span><span class="token punctuation">(</span><span class="token class-name">DiscoverySelectors</span><span class="token punctuation">.</span><span class="token function">selectClass</span><span class="token punctuation">(</span><span class="token class-name">PerformanceTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            summaryListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TestExecutionSummary</span> summary <span class="token operator">=</span> summaryListener<span class="token punctuation">.</span><span class="token function">getSummary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    summary<span class="token punctuation">.</span><span class="token function">printFailuresTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>summary<span class="token punctuation">.</span><span class="token function">getTotalFailureCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Unlike the rest of JMeter DSL which is compiled with Java 8, <code>jmdsl.jar</code> and <code>us.abstracta.jmeter:jmeter-java-dsl-cli</code> are compiled with Java 11 due to some dependencies requirement (latest Selenium drivers mainly).</p><p>So, to run above commands, you will need Java 11 or newer.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Review and try generated code before executing it as is. I.e: tune thread groups and iterations to 1 to give it a try.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Always review generated DSL code. You should add proper assertions to it, might want to clean it up, add to your maven or gradle project dependencies listed on initial comments of generated code, modularize it better, check that conversion is accurate according to DSL, or even propose improvements for it in the GitHub repository.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Conversions can always be improved, and since there are many combinations and particular use cases, different semantics, etc, getting a perfect conversion for every scenario can get tricky.</p><p>If you find any potential improvement to code generation, <strong>please help us by creating an <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> or <a href="https://github.com/abstracta/jmeter-java-dsl/discussions" target="_blank" rel="noopener noreferrer">discussion<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong> in GitHub repository.</p></div><h2 id="run-test-at-scale" tabindex="-1"><a class="header-anchor" href="#run-test-at-scale" aria-hidden="true">#</a> Run test at scale</h2><p>Running a load test from one machine is not always enough, since you are limited to the machine&#39;s hardware capabilities. Sometimes, is necessary to run the test using a cluster of machines to be able to generate enough load for the system under test.</p><h3 id="blazemeter" tabindex="-1"><a class="header-anchor" href="#blazemeter" aria-hidden="true">#</a> BlazeMeter</h3><p>By including the following module as a dependency:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-blazemeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-blazemeter:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>You can easily run a JMeter test plan at scale in <a href="https://www.blazemeter.com/" target="_blank" rel="noopener noreferrer">BlazeMeter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>blazemeter<span class="token punctuation">.</span></span><span class="token class-name">BlazeMeterEngine</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token comment">// number of threads and iterations are in the end overwritten by BlazeMeter engine settings </span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">testName</span><span class="token punctuation">(</span><span class="token string">&quot;DSL test&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">totalUsers</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">holdFor</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">threadsPerEngine</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">testTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>This test is using <code>BZ_TOKEN</code>, a custom environment variable with <code>&lt;KEY_ID&gt;:&lt;KEY_SECRET&gt;</code> format, to get the BlazeMeter API authentication credentials.</p></blockquote><p>Note that is as simple as <a href="https://guide.blazemeter.com/hc/en-us/articles/115002213289-BlazeMeter-API-keys-" target="_blank" rel="noopener noreferrer">generating a BlazeMeter authentication token<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and adding <code>.runIn(new BlazeMeterEngine(...))</code> to any existing jmeter-java-dsl test to get it running at scale in BlazeMeter.</p><p>BlazeMeter will not only allow you to run the test at scale but also provides additional features like nice real-time reporting, historic data tracking, etc. Here is an example of how a test would look in BlazeMeter:</p><p><img src="/jmeter-java-dsl/assets/blazemeter-85d7b816.png" alt="BlazeMeter Example Execution Dashboard"></p><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-blazemeter/src/main/java/us/abstracta/jmeter/javadsl/blazemeter/BlazeMeterEngine.java" target="_blank" rel="noopener noreferrer">BlazeMeterEngine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for details on usage and available settings when running tests in BlazeMeter.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>By default the engine is configured to timeout if test execution takes more than 1 hour. This timeout exists to avoid any potential problem with BlazeMeter execution not detected by the client, and avoid keeping the test indefinitely running until is interrupted by a user, which may incur in unnecessary expenses in BlazeMeter and is specially annoying when running tests in automated fashion, for example in CI/CD. It is strongly advised to <strong>set this timeout properly in each run</strong>, according to the expected test execution time plus some additional margin (to consider for additional delays in BlazeMeter test setup and teardown) to avoid unexpected test plan execution failure (due to timeout) or unnecessary waits when there is some unexpected issue with BlazeMeter execution.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>BlazeMeterEngine</code> always returns 0 as <code>sentBytes</code> statistics since there is no efficient way to get it from BlazMeter.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>BlazeMeterEngine</code> will automatically upload to BlazeMeter files used in <code>csvDataSet</code> and <code>httpSampler</code> with <code>bodyFile</code> or <code>bodyFilePart</code> methods.</p><p>For example this test plan works out of the box (no need for uploading referenced files or adapt test plan):</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">csvDataSet</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestResource</span><span class="token punctuation">(</span><span class="token string">&quot;users.csv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token constant">SAMPLE_LABEL</span><span class="token punctuation">,</span> <span class="token string">&quot;https://myservice/users/${USER}&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">testTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you need additional files to be uploaded to BlazeMeter, you can easily specify them with the <code>BlazemeterEngine.assets()</code> method.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default <code>BlazeMeterEngine</code> will run tests from default location (most of the times <code>us-east4-a</code>). But in some scenarios you might want to change the location, or even run the test from multiple locations.</p><p>Here is an example how you can easily set this up:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 300 total users for 5 minutes</span>
      <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token constant">SAMPLE_LABEL</span><span class="token punctuation">,</span> <span class="token string">&quot;https://myservice&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token class-name">BlazeMeterLocation</span><span class="token punctuation">.</span><span class="token constant">GCP_SAO_PAULO</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment">// 30% = 90 users will run in Google Cloud Platform at Sao Paulo</span>
    <span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token string">&quot;MyPrivateLocation&quot;</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span> <span class="token comment">// 70% = 210 users will run in MyPrivateLocation named private location</span>
    <span class="token punctuation">.</span><span class="token function">testTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>In case you want to get debug logs for HTTP calls to BlazeMeter API, you can include the following setting to an existing <code>log4j2.xml</code> configuration file:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>us.abstracta.jmeter.javadsl.blazemeter.BlazeMeterClient<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>okhttp3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>If you use test elements (JSR223 elements, <code>httpSamplers</code>, <code>ifController</code> or <code>whileController</code>) with Java lambdas instead of strings, check <a href="#lambdas">this section of the user guide</a> to use them while running test plan in BlazeMeter.</p></div><h3 id="octoperf" tabindex="-1"><a class="header-anchor" href="#octoperf" aria-hidden="true">#</a> OctoPerf</h3><p>In the same fashion as with BlazeMeter, just by including the following module as a dependency:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-octoperf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-octoperf:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>You can easily run a JMeter test plan at scale in <a href="https://octoperf.com/" target="_blank" rel="noopener noreferrer">OctoPerf<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>octoperf<span class="token punctuation">.</span></span><span class="token class-name">OctoPerfEngine</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token comment">// number of threads and iterations are in the end overwritten by OctoPerf engine settings </span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OctoPerfEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;OCTOPERF_API_KEY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">projectName</span><span class="token punctuation">(</span><span class="token string">&quot;DSL test&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">totalUsers</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">rampUpFor</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">holdFor</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">testTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>This test is using <code>OCTOPERF_API_KEY</code>, a custom environment variable containing an OctoPerf API key.</p></blockquote><p>Note that, as with the BlazeMeter case, it is as simple as <a href="https://doc.octoperf.com/account/profile/#apikey" target="_blank" rel="noopener noreferrer">getting the OctoPerf API key<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and adding <code>.runIn(new OctoPerfEngine(...))</code> to any existing jmeter-java-dsl test to get it running at scale in OctoPerf.</p><p>As with the BlazeMeter case, with OctoPerf you can not only run the test at scale but also get additional features like nice real-time reporting, historic data tracking, etc. Here is an example of how a test looks like in OctoPerf:</p><p><img src="/jmeter-java-dsl/assets/octoperf-cf8e523e.png" alt="OctoPerf Example Execution Dashboard"></p><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-octoperf/src/main/java/us/abstracta/jmeter/javadsl/octoperf/OctoPerfEngine.java" target="_blank" rel="noopener noreferrer">OctoPerfEngine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for details on usage and available settings when running tests in OctoPerf.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>To avoid piling up virtual users and scenarios in OctoPerf project, OctoPerfEngine deletes any OctoPerfEngine previously created entities (virtual users and scenarios with <code>jmeter-java-dsl</code> tag) in the project.</p><p><strong>It is very important that you use different project names for different projects</strong> to avoid interference (parallel execution of two jmeter-java-dsl projects).</p><p>If you want to disable this automatic cleanup, you can use the existing OctoPerfEngine method <code>.projectCleanUp(false)</code>.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>In case you want to get debug logs for HTTP calls to OctoPerf API, you can include the following setting to an existing <code>log4j2.xml</code> configuration file:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>us.abstracta.jmeter.javadsl.octoperf.OctoPerfClient<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>okhttp3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>There is currently no built-in support for test elements with Java lambdas in <code>OctoPerfEngine</code> (as there is for <code>BlazeMeterEngine</code>). If you need it, please request it by creating a <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">GitHub issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>By default the engine is configured to timeout if test execution takes more than 1 hour. This timeout exists to avoid any potential problem with OctoPerf execution not detected by the client, and avoid keeping the test indefinitely running until is interrupted by a user, which is specially annoying when running tests in automated fashion, for example in CI/CD. It is strongly advised to <strong>set this timeout properly in each run</strong>, according to the expected test execution time plus some additional margin (to consider for additional delays in OctoPerf test setup and teardown) to avoid unexpected test plan execution failure (due to timeout) or unnecessary waits when there is some unexpected issue with OctoPerf execution.</p></div><h3 id="azure-load-testing" tabindex="-1"><a class="header-anchor" href="#azure-load-testing" aria-hidden="true">#</a> Azure Load Testing</h3><p>To use <a href="https://azure.microsoft.com/en-us/products/load-testing/" target="_blank" rel="noopener noreferrer">Azure Load Testing<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to execute your test plans at scale, is as easy as including the following module as a dependency:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-azure<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-azure:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And using the provided engine like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>azure<span class="token punctuation">.</span></span><span class="token class-name">AzureEngine</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AzureEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;AZURE_CREDS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// AZURE_CREDS=tenantId:clientId:secretId</span>
        <span class="token punctuation">.</span><span class="token function">testName</span><span class="token punctuation">(</span><span class="token string">&quot;dsl-test&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">/* 
        This specifies the number of engine instances used to execute the test plan. 
        In this case means that it will run 2(threads in thread group)x2(engines)=4 concurrent users/threads in total. 
        Each engine executes the test plan independently.
         */</span>
        <span class="token punctuation">.</span><span class="token function">engines</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 
        <span class="token punctuation">.</span><span class="token function">testTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>This test is using <code>AZURE_CREDS</code>, a custom environment variable containing <code>tenantId:clientId:clientSecret</code> with proper values for each. Check in <a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/TenantPropertiesBlade" target="_blank" rel="noopener noreferrer">Azure Portal tenant properties<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> the proper tenant ID for your subscription, and follow <a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal" target="_blank" rel="noopener noreferrer">this guide<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to register an application with proper permissions and secrets generation for tests execution.</p></blockquote><p>As with the BlazeMeter and OctoPerf, you can not only run the test at scale but also get additional features like nice real-time reporting, historic data tracking, etc. Here is an example of how a test looks like in Azure Load Testing:</p><p><img src="/jmeter-java-dsl/assets/azure-35125246.png" alt="Azure Load Testing Example Execution Dashboard"></p><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-azure/src/main/java/us/abstracta/jmeter/javadsl/azure/AzureEngine.java" target="_blank" rel="noopener noreferrer">AzureEngine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for details on usage and available settings when running tests in Azure Load Testing.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>AzureEngine</code> will automatically upload to Azure Load Testing files used in <code>csvDataSet</code> and <code>httpSampler</code> with <code>bodyFile</code> or <code>bodyFilePart</code> methods.</p><p>For example this test plan works out of the box (no need for uploading referenced files or adapt test plan):</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">csvDataSet</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestResource</span><span class="token punctuation">(</span><span class="token string">&quot;users.csv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token constant">SAMPLE_LABEL</span><span class="token punctuation">,</span> <span class="token string">&quot;https://myservice/users/${USER}&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AzureEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">testTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you need additional files to be uploaded to Azure Load Testing, you can easily specify them with the <code>AzureEngine.assets()</code> method.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you use a <code>csvDataSet</code> and multiple Azure engines (through the <code>engines()</code> method) and want to split provided CSVs between the Azure engines, as to not generate same requests from each engine, then you can use <code>splitCsvsBetweenEngines</code>.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you want to correlate test runs to other entities (like a CI/CD job id, product version release, git commit, etc) you can add such information in the test run name by using the <code>testRunName()</code> method.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>To get a full view in Azure Load Testing test run execution report not only of the performance test collected metrics, but also metrics from the application components under test, you can register all the application components using the <code>monitoredResources()</code> method.</p><p><code>monitoredResources()</code> requires a list of resources ids, which you can get by navigating in Azure portal to the correct resource, and then copy part of the url from the browser. For example, a resource id for a container app looks like <code>/subscriptions/my-subscription-id/resourceGroups/my-resource-group/providers/Microsoft.App/containerapps/my-papp</code>.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>As with BlazeMeter and OctoPerf cases, if you want to get debug logs for HTTP calls to Azure API, you can include the following setting to an existing <code>log4j2.xml</code> configuration file:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>us.abstracta.jmeter.javadsl.azure.AzureClient<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>okhttp3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>There is currently no built-in support for test elements with Java lambdas in <code>AzureEngine</code> (as there is for <code>BlazeMeterEngine</code>). If you need it, please request it by creating a <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">GitHub issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>By default the engine is configured to timeout if test execution takes more than 1 hour. This timeout exists to avoid any potential problem with Azure Load Testing execution not detected by the client, and avoid keeping the test indefinitely running until is interrupted by a user, which may incur in unnecessary expenses in Azure and is specially annoying when running tests in automated fashion, for example in CI/CD. It is strongly advised to <strong>set this timeout properly in each run</strong>, according to the expected test execution time plus some additional margin (to consider for additional delays in Azure Load Testing test setup and teardown) to avoid unexpected test plan execution failure (due to timeout) or unnecessary waits when there is some unexpected issue with Azure Load Testing execution.</p></div><h3 id="jmeter-remote-testing" tabindex="-1"><a class="header-anchor" href="#jmeter-remote-testing" aria-hidden="true">#</a> JMeter remote testing</h3><p>JMeter already provides means to run a test on several machines controlled by one master/client machine. This is referred as <a href="http://jmeter.apache.org/usermanual/remote-test.html" target="_blank" rel="noopener noreferrer">Remote Testing<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>JMeter remote testing requires setting up nodes in server/slave mode (using <code>bin/jmeter-server</code> JMeter script) with a configured keystore (usually <code>rmi_keystore.jks</code>, generated with <code>bin/</code> JMeter script) which will execute a test plan triggered in a client/master node.</p><p>You can trigger such tests with the DSL using <code>DistributedJmeterEngine</code> as in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engines<span class="token punctuation">.</span></span><span class="token class-name">DistributedJmeterEngine</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DistributedJmeterEngine</span><span class="token punctuation">(</span><span class="token string">&quot;host1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;host2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will run 200 users for 10 minutes on each server/slave (<code>host1</code> and <code>host2</code>) and aggregate all the results in returned stats.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Use same version used by JMeter DSL when setting up the cluster to avoid any potential issues.</p><p>For instance, JMeter 5.6 has introduced some changes that currently break some plugins using by JMeter DSL, or change default behavior for test plans.</p><p>To find out the current version of JMeter DSL you can check JMeter jars version in your project dependency tree. E.g.:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mvn dependency:tree <span class="token parameter variable">-Dincludes</span><span class="token operator">=</span>org.apache.jmeter:ApacheJMeter_core
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Or check JMeter DSL <a href="https://github.com/abstracta/jmeter-java-dsl/blob/8a8eb303d1013676bf669116ddc8f056e8a445d8/pom.xml#L51" target="_blank" rel="noopener noreferrer">pom.xml property <code>jmeter.version</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>To be able to run the test you require the <code>rmi_keystore.jks</code> file in the working directory of the test. For the time being, we couldn&#39;t find a way to allow setting any arbitrary path for the file.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>In general, prefer using BlazeMeter, OctoPerf or Azure options which avoid all the setup and maintenance costs of the infrastructure required by JMeter remote testing, also benefiting from other additional useful features they provide (like reporting capabilities).</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/scale/distributed" target="_blank" rel="noopener noreferrer">Here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is an example project using <code>docker-compose</code> that starts a JMeter server/slave and executes a test with it. If you want to do a similar setup, generate your own keystore and properly tune RMI remote server in server/slave.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/engines/DistributedJmeterEngine.java" target="_blank" rel="noopener noreferrer">DistributedJmeterEngine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="http://jmeter.apache.org/usermanual/remote-test.html" target="_blank" rel="noopener noreferrer">JMeter documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for proper setup and additional options.</p><h2 id="auto-stop" tabindex="-1"><a class="header-anchor" href="#auto-stop" aria-hidden="true">#</a> Auto Stop</h2><p>As previously shown, it is quite easy to check after test plan execution if the collected metrics are the expected ones and fail/pass the test accordingly.</p><p>But, what if you want to stop your test plan as soon as the metrics deviate from expected ones? This could help avoiding unnecessary resource usage, especially when conducting tests at scale to avoid incurring additional costs.</p><p>With JMeter DSL you can easily define auto-stop conditions over collected metrics, that when met will stop the test plan and throw an exception that will make your test fail.</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span></span><span class="token class-name">AutoStopListener</span><span class="token punctuation">.</span><span class="token class-name">AutoStopCondition</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">autoStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// when any sample fails, then test plan will stop and an exception will be thrown pointing to this condition.</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/listeners/AutoStopListener.java" target="_blank" rel="noopener noreferrer">AutoStopListener<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for details on available options for auto-stop conditions.</p><p><code>autoStop</code> is inspired in <a href="https://jmeter-plugins.org/wiki/AutoStop/" target="_blank" rel="noopener noreferrer">JMeter AutoStop Plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, but provides a lot more flexibility.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>autoStop</code> will only consider samples within its scope.</p><p>If you place it as a test plan child, then it will evaluate metrics for all samples. If you place it as a thread group child, then it will evaluate metrics for samples of such thread group. If you place it as a controller child, then only samples within such controller. And, if you place it as a sampler child, it will only evaluate samples for that particular sampler.</p><p>Additionally, you can use the <code>samplesMatching(regex)</code> method to only evaluate metrics for a subset of samples within a given scope (eg: all samples with a label starting with <code>users</code>).</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can add multiple <code>autoStop</code> elements within a test plan. The first one containing a condition that is met will trigger the auto-stop.</p><p>To identify which <code>autoStop</code> element triggered, you can specify a name, like <code>autoStop(&quot;login&quot;)</code>, and the associated name will be included in the exception thrown by <code>autoStop</code> when the test plan is stopped.</p><p>Additionally, you can specify several conditions on an <code>autoStop</code> element. When any of such conditions are met, then the test plan is stopped.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, <code>autoStop</code> will evaluate each condition for each sample and stop the test plan as soon as a condition is met.</p><p>This behavior is different from <a href="https://jmeter-plugins.org/wiki/AutoStop/" target="_blank" rel="noopener noreferrer">JMeter AutoStop Plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, which evaluates and resets aggregations (it only provides average aggregation) for every second.</p><p>To change this behavior you can use the <code>every(Duration)</code> method (after specifying the aggregation method, eg <code>errors().perSecond().every(Duration.ofSeconds(5)))</code>) to specify that the condition should only be evaluated, and the aggregation reset, for every given period.</p><p><strong>This is particularly helpful for some aggregations (like <code>mean</code>, <code>perSecond</code>, and <code>percent</code>) which may get &quot;stuck&quot; due to historical values collected for the metric.</strong></p><p>As an example to illustrate this issue, consider the scenario where after 10 minutes you get 10k requests with an average sample time of 1 second, but in the last 10 seconds you get 10 requests with an average of 10 seconds. In this scenario, the general average will not be much affected by the last seconds, but you would in any case want to stop the test plan since last seconds average has been way up the expected value. This is a clear scenario where you would like to use the <code>every()</code> method.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, <code>autoStop</code> will stop the test plan as soon as the condition is met, but in many cases it is better to wait for the condition to be met for some period of time, to avoid some intermittent or short-lived condition. To not stop the test plan until the condition holds for a given period of time, you can use <code>holdsFor(Duration)</code> at the end of your condition.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>autoStop</code> will automatically work with <code>AzureEngine</code>. But no support has been implemented yet for <code>BlazeMeterEngine</code> or <code>OctoPerfEngine</code>. If you need such support, please create <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">an issue in the GitHub repository<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><h2 id="advanced-threads-configuration" tabindex="-1"><a class="header-anchor" href="#advanced-threads-configuration" aria-hidden="true">#</a> Advanced threads configuration</h2><p>jmeter-java-dsl provides two simple ways of creating thread groups which are used in most scenarios:</p><ul><li>specifying threads and the number of iterations each thread should execute before ending the test plan</li><li>specifying threads and duration for which each thread should execute before the test plan ends</li></ul><p>This is how they look in code:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// 10 threads for 20 iterations each</span>
<span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// 10 threads for 20 seconds each</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>But these options are not good when working with many threads or when trying to configure some complex test scenarios (like when doing incremental or peak tests).</p><h3 id="thread-ramps-and-holds" tabindex="-1"><a class="header-anchor" href="#thread-ramps-and-holds" aria-hidden="true">#</a> Thread ramps and holds</h3><p>When working with many threads, it is advisable to configure a ramp-up period, to avoid starting all threads at once affecting performance metrics and generation.</p><p>You can easily configure a ramp-up with the DSL like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">holdIterating</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// ramp to 10 threads for 5 seconds (1 thread every half second) and iterating each thread 20 times</span>
<span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//similar as above but after ramping up holding execution for 20 seconds</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Additionally, you can use and combine these same methods to configure more complex scenarios (incremental, peak, and any other types of tests) like the following one:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
      <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Which would translate into the following threads&#39; timeline:</p><p><img src="/jmeter-java-dsl/assets/ultimate-thread-group-timeline-471befb4.png" alt="Thread Group Timeline"></p><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/DslDefaultThreadGroup.java" target="_blank" rel="noopener noreferrer">DslDefaultThreadGroup<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>To visualize the threads timeline, for complex thread group configurations like the previous one, you can get a chart like the previous one by using provided <code>DslThreadGroup.showTimeline()</code> method.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you are a JMeter GUI user, you may even be interested in using provided <code>TestElement.showInGui()</code> method, which shows the JMeter test element GUI that could help you understand what will DSL execute in JMeter. You can use this method with any test element generated by the DSL (not just thread groups).</p><p>For example, for the above test plan you would get a window like the following one:</p><p><img src="/jmeter-java-dsl/assets/ultimate-thread-group-gui-400bcb90.png" alt="UltimateThreadGroup GUI"></p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When using multiple thread groups in a test plan, consider setting a name (eg: <code>threadGroup(&quot;main&quot;, 1, 1, ...)</code>) on them to properly identify associated requests in statistics &amp; jtl results.</p></div><h3 id="throughput-based-thread-group" tabindex="-1"><a class="header-anchor" href="#throughput-based-thread-group" aria-hidden="true">#</a> Throughput based thread group</h3><p>Sometimes you want to focus just on the number of requests per second to generate and don&#39;t want to be concerned about how many concurrent threads/users, and pauses between requests, are needed. For these scenarios you can use <code>rpsThreadGroup</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">rpsThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">maxThreads</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
      <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will internally use JMeter <a href="https://jmeter-plugins.org/wiki/ConcurrencyThreadGroup/" target="_blank" rel="noopener noreferrer">Concurrency Thread Group<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> element in combination with <a href="https://jmeter-plugins.org/wiki/ThroughputShapingTimer/" target="_blank" rel="noopener noreferrer">Throughput Shaping Time<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>rpsThreadGroup</code> will dynamically create and remove threads and add delays between requests to match the traffic to the expected RPS. You can also specify to control iterations per second (the number of times the flow in the thread group runs per second) instead of threads by using <code>.counting(RpsThreadGroup.EventType.ITERATIONS)</code>.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>RPS values control how often to adjust threads and waits. Avoid too low (eg: under 1) values which can cause big waits and don&#39;t match the expected RPS.</p><p>JMeter Throughput Shaping Timer calculates each time the delay to be used not taking into consideration future expected RPS. For instance, if you configure 1 thread with a ramp from 0.01 to 10 RPS with 10 seconds duration, when 1 request is sent it will calculate that to match 0.01 RPS has to wait <code>requestsCount/expectedRPS = 1/0.01 = 100</code> seconds, which would keep the thread stuck for 100 seconds when in fact should have done two additional requests after waiting 1 second (to match the ramp). Setting this value greater or equal to 1 will assure at least 1 evaluation every second.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>When no <code>maxThreads</code> are specified, <code>rpsThreadGroup</code> will use as many threads as needed. In such scenarios, you might face an unexpected number of threads with associated CPU and Memory requirements, which may affect the performance test metrics. <strong>You should always set maximum threads to use</strong> to avoid such scenarios.</p><p>You can use the following formula to calculate a value for <code>maxThreads</code>: <code>T*R</code>, being <code>T</code> the maximum RPS that you want to achieve and <code>R</code> the maximum expected response time (or iteration time if you use <code>.counting(RpsThreadGroup.EventType.ITERATIONS)</code>) in seconds.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>As with the default thread group, with <code>rpsThreadGroup</code> you can use <code>showTimeline</code> to get a chart of configured RPS profile for easy visualization. An example chart:</p><p><img src="/jmeter-java-dsl/assets/rps-thread-group-timeline-11c83237.png" alt="RPS Thread Group Timeline"></p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/RpsThreadGroup.java" target="_blank" rel="noopener noreferrer">RpsThreadGroup<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="set-up-tear-down" tabindex="-1"><a class="header-anchor" href="#set-up-tear-down" aria-hidden="true">#</a> Set up &amp; tear down</h3><p>When you need to run some custom logic before or after a test plan, the simplest approach is just adding plain java code to it, or using your test framework (eg: JUnit) provided features for this purpose. Eg:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AfterEach</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@BeforeEach</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// my custom setup logic</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@AfterEach</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// my custom setup logic</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>But, in some cases you may need the logic to run inside the JMeter execution context (eg: set some JMeter properties), or, when the test plan runs at scale, to run in the same host where the test plan runs (for example to use some common file).</p><p>In such scenarios you can use provided <code>setupThreadGroup</code> &amp; <code>teardownThreadGroup</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HTTPConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">setupThreadGroup</span><span class="token punctuation">(</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/tokens&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span><span class="token string">&quot;props.put(&#39;MY_TEST_TOKEN&#39;, prev.responseDataAsString)&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/products&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-MY-TOKEN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;${__P(MY_TEST_TOKEN)}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">teardownThreadGroup</span><span class="token punctuation">(</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/tokens/${__P(MY_TEST_TOKEN)}&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, JMeter automatically executes teardown thread groups when a test plan stops due to an unscheduled event like a sample error when a stop test action is configured in a thread group, invocation of <code>ctx.getEngine().askThreadsToStop()</code> in jsr223 element, etc. You can disable this behavior by using the testPlan <code>tearDownOnlyAfterMainThreadsDone</code> method, which might be helpful if the teardown thread group has only to run on clean test plan completion.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/DslSetupThreadGroup.java" target="_blank" rel="noopener noreferrer">DslSetupThreadGroup<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/DslTeardownThreadGroup.java" target="_blank" rel="noopener noreferrer">DslTeardownThreadGroup<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional tips and details on the usage of these components.</p><h3 id="thread-groups-order" tabindex="-1"><a class="header-anchor" href="#thread-groups-order" aria-hidden="true">#</a> Thread groups order</h3><p>By default, when you add multiple thread groups to a test plan, JMeter will run them all in parallel. This is a very helpful behavior in many cases, but in some others, you may want to run them sequentially (one after the other). To achieve this you can just use <code>sequentialThreadGroups()</code> test plan method.</p><h2 id="test-plan-debugging" tabindex="-1"><a class="header-anchor" href="#test-plan-debugging" aria-hidden="true">#</a> Test plan debugging</h2><p>A usual requirement while building a test plan is to be able to review requests and responses and debug the test plan for potential issues in the configuration or behavior of the service under test. With jmeter-java-dsl you have several options for this purpose.</p><h3 id="view-results-tree" tabindex="-1"><a class="header-anchor" href="#view-results-tree" aria-hidden="true">#</a> View results tree</h3><p>One option is using provided <code>resultsTreeVisualizer()</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">resultsTreeVisualizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will display the JMeter built-in View Results Tree element, which allows you to review request and response contents in addition to collected metrics (spent time, sent &amp; received bytes, etc.) for each request sent to the server, in a window like this one:</p><p><img src="/jmeter-java-dsl/assets/view-results-tree-431a3001.png" alt="View Results Tree GUI"></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>To debug test plans use a few iterations and threads to reduce the execution time and ease tracing by having less information to analyze.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When adding <code>resultsTreeVisualizer()</code> as a child of a thread group, it will only display sample results of that thread group. When added as a child of a sampler, it will only show sample results for that sampler. You can use this to only review certain sample results in your test plan.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><strong>Remove <code>resultsTreeVisualizer()</code> from test plans when are no longer needed</strong> (when debugging is finished). Leaving them might interfere with unattended test plan execution (eg: in CI) due to test plan execution not finishing until all visualizers windows are closed.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>By default, View Results Tree only displays the last 500 sample results. If you need to display more elements, use provided <code>resultsLimit(int)</code> method which allows changing this value. Take into consideration that the more results are shown, the more memory that will require. So use this setting with care.</p></div><h3 id="post-processor-breakpoints" tabindex="-1"><a class="header-anchor" href="#post-processor-breakpoints" aria-hidden="true">#</a> Post-processor breakpoints</h3><p>Another alternative is using IDE&#39;s built-in debugger by adding a <code>jsr223PostProcessor</code> with java code and adding a breakpoint to the post-processor code. This does not only allow checking sample result information but also JMeter variables and properties values and sampler properties.</p><p>Here is an example screenshot using this approach while debugging with an IDE:</p><p><img src="/jmeter-java-dsl/assets/post-processor-debugging-2735516e.png" alt="Post Processor debugging in IDE"></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>DSL provides following methods to ease results and variables visualization and debugging: <code>varsMap()</code>, <code>prevMap()</code>, <code>prevMetadata()</code>, <code>prevMetrics()</code>, <code>prevRequest()</code>, <code>prevResponse()</code>. Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslJsr223PostProcessor.java" target="_blank" rel="noopener noreferrer">PostProcessorVars<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/testelements/DslJsr223TestElement.java" target="_blank" rel="noopener noreferrer">Jsr223ScriptVars<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Remove such post processors when no longer needed (when debugging is finished). Leaving them would generate errors when loading generated JMX test plan or running the test plan in BlazeMeter, OctoPerf or Azure, in addition to unnecessary processing time and resource usage.</p></div><h3 id="debug-info-during-test-plan-execution" tabindex="-1"><a class="header-anchor" href="#debug-info-during-test-plan-execution" aria-hidden="true">#</a> Debug info during test plan execution</h3><p>Another option that allows collecting debugging information during a test plan execution without affecting test plan execution (doesn&#39;t stop the test plan on each breakpoint as IDE debugger does, which will affect test plan collected metrics) and allows analyzing information after test plan execution, is using <code>debugPostProcessor</code> which adds a sub result to sampler results including debug information.</p><p>Here is an example that collects JMeter variables that can be reviewed with included <code>resultsTreeVisualizer</code>:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> userIdVarName <span class="token operator">=</span> <span class="token string">&quot;USER_ID&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> usersPath <span class="token operator">=</span> <span class="token string">&quot;/users&quot;</span><span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span>usersPath<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsonExtractor</span><span class="token punctuation">(</span>userIdVarName<span class="token punctuation">,</span> <span class="token string">&quot;[].id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">debugPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span>usersPath <span class="token operator">+</span> <span class="token string">&quot;/${&quot;</span> <span class="token operator">+</span> userIdVarName <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">resultsTreeVisualizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This approach is particularly helpful when debugging extractors, allowing you to see what JMeter variables were or were not generated by previous extractors.</p><p>In general, prefer using <a href="#post-processor-breakpoints">Post processor with IDE debugger breakpoint</a> in the initial stages of test plan development, testing with just 1 thread in thread groups, and using this later approach when trying to debug issues that are reproducible only in multiple threads executions or in a particular environment that requires offline analysis (analyze collected information after test plan execution).</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Use this element in combination with <code>resultsTreeVisualizer</code> to review live executions, or use <code>jtlWriter</code> with <code>withAllFields()</code> or <code>saveAsXml(true)</code> and <code>saveResponseData(true)</code> to generate a jtl file for later analysis.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, <code>debugPostProcessor</code> will only include JMeter variables in generated sub sampler, which covers the most used case and keeps memory and disk usage low. <code>debugPostProcessor</code> includes additional methods that allow including other information like sampler properties, JMeter properties, and system properties. Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslDebugPostProcessor.java" target="_blank" rel="noopener noreferrer">DslDebugPostProcessor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p></div><h3 id="debug-jmeter-code" tabindex="-1"><a class="header-anchor" href="#debug-jmeter-code" aria-hidden="true">#</a> Debug JMeter code</h3><p>You can even add breakpoints to JMeter code in your IDE and debug the code line by line providing the greatest possible detail.</p><p>Here is an example screenshot debugging HTTP Sampler:</p><p><img src="/jmeter-java-dsl/assets/jmeter-http-sampler-debugging-4b2e79d2.png" alt="JMeter HTTP Sampler debugging in IDE"></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>JMeter class in charge of executing threads logic is <code>org.apache.jmeter.threads.JMeterThread</code>. You can check the classes used by each DSL-provided test element by checking the DSL code.</p></div><h3 id="debug-groovy-code" tabindex="-1"><a class="header-anchor" href="#debug-groovy-code" aria-hidden="true">#</a> Debug Groovy code</h3><p>In some cases, you may want to debug some Groovy script used in some sampler, pre-, or post-processor. For such scenarios, you can check <a href="https://github.com/abstracta/jmeter-java-dsl/issues/41#issuecomment-966715062" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> where we list some options.</p><h3 id="dummy-sampler" tabindex="-1"><a class="header-anchor" href="#dummy-sampler" aria-hidden="true">#</a> Dummy sampler</h3><p>In many cases you want to be able to test part of the test plan but without directly interacting with the service under test, avoiding any potential traffic to the servers, testing some border cases which might be difficult to reproduce with the actual server, and avoid actual server interactions variability and potential unpredictability. In such scenarios, you might replace actual samplers with <code>dummySampler</code> (which uses <a href="https://jmeter-plugins.org/wiki/DummySampler/" target="_blank" rel="noopener noreferrer">Dummy Sampler plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>) to be able to test extractors, assertions, controllers conditions, and other parts of the test plan under certain conditions/results generated by the samplers.</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> usersIdVarName <span class="token operator">=</span> <span class="token string">&quot;USER_IDS&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> userIdVarName <span class="token operator">=</span> <span class="token string">&quot;USER_ID&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> usersPath <span class="token operator">=</span> <span class="token string">&quot;/users&quot;</span><span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token comment">// httpSampler(usersPath)</span>
            <span class="token function">dummySampler</span><span class="token punctuation">(</span><span class="token string">&quot;[{\&quot;id\&quot;: 1, \&quot;name\&quot;: \&quot;John\&quot;}, {\&quot;id\&quot;: 2, \&quot;name\&quot;: \&quot;Jane\&quot;}]&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsonExtractor</span><span class="token punctuation">(</span>usersIdVarName<span class="token punctuation">,</span> <span class="token string">&quot;[].id&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">matchNumber</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">forEachController</span><span class="token punctuation">(</span>usersIdVarName<span class="token punctuation">,</span> userIdVarName<span class="token punctuation">,</span>
                <span class="token comment">// httpSampler(usersPath + &quot;/${&quot; + userIdVarName + &quot;}&quot;)</span>
                <span class="token function">dummySampler</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John or Jane\&quot;}&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/&quot;</span> <span class="token operator">+</span> usersPath <span class="token operator">+</span> <span class="token string">&quot;/${&quot;</span> <span class="token operator">+</span> userIdVarName <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">resultsTreeVisualizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>The DSL configures dummy samplers by default, in contrast to what JMeter does, with response time simulation disabled. This allows to speed up the debugging process, not having to wait for proper response time simulation (sleeps/waits). If you want a more accurate emulation, you might turn it on through <code>responseTimeSimulation()</code> method.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/samplers/DslDummySampler.java" target="_blank" rel="noopener noreferrer">DslDummySampler<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more information o additional configuration and options.</p><h3 id="test-plan-review-in-jmeter-gui" tabindex="-1"><a class="header-anchor" href="#test-plan-review-in-jmeter-gui" aria-hidden="true">#</a> Test plan review in JMeter GUI</h3><p>A usual requirement for new DSL users that are used to Jmeter GUI, is to be able to review Jmeter DSL generated test plan in the familiar JMeter GUI. For this, you can use <code>showInGui()</code> method in a test plan to open JMeter GUI with the preloaded test plan.</p><p>This can be also used to debug the test plan, by adding elements (like view results tree, dummy samplers, debug post-processors, etc.) in the GUI and running the test plan.</p><p>Here is a simple example using the method:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">showInGui</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Which ends up opening a window like this one:</p><p><img src="/jmeter-java-dsl/assets/test-plan-gui-a4e8b653.png" alt="Test plan in JMeter GUI"></p><h2 id="reporting" tabindex="-1"><a class="header-anchor" href="#reporting" aria-hidden="true">#</a> Reporting</h2><p>Once you have a test plan you would usually want to be able to analyze the collected information. This section contains several ways to achieve this.</p><h3 id="log-requests-and-responses" tabindex="-1"><a class="header-anchor" href="#log-requests-and-responses" aria-hidden="true">#</a> Log requests and responses</h3><p>The main mechanism provided by JMeter (and jmeter-java-dsl) to get information about generated requests, responses, and associated metrics is through the generation of JTL files.</p><p>This can be easily achieved in jmeter-java-dsl by using provided <code>jtlWriter</code> like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">jtlWriter</span><span class="token punctuation">(</span><span class="token string">&quot;target/jtls&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, <code>jtlWriter</code> will write the most used information to evaluate the performance of the tested service. If you want to trace all the information of each request you may use <code>jtlWriter</code> with <code>withAllFields()</code> option. Doing this will provide all the information at the cost of additional computation and resource usage (fewer resources for actual load testing). You can tune which fields to include or not with <code>jtlWriter</code> and only log what you need, check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/listeners/JtlWriter.java" target="_blank" rel="noopener noreferrer">JtlWriter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, <code>jtlWriter</code> will log every sample result, but in some cases you might want to log additional info when a sample result fails. In such scenarios you can use two <code>jtlWriter</code> instances like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">jtlWriter</span><span class="token punctuation">(</span><span class="token string">&quot;target/jtls/success&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">logOnly</span><span class="token punctuation">(</span><span class="token class-name">SampleStatus</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">jtlWriter</span><span class="token punctuation">(</span><span class="token string">&quot;target/jtls/error&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">logOnly</span><span class="token punctuation">(</span><span class="token class-name">SampleStatus</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withAllFields</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>jtlWriter</code> will automatically generate <code>.jtl</code> files applying this format: <code>&lt;yyyy-MM-dd HH-mm-ss&gt; &lt;UUID&gt;.jtl</code>.</p><p>If you need a specific file name, for example for later postprocessing logic (eg: using CI build ID), you can specify it by using <code>jtlWriter(directory, fileName)</code>.</p><p>When specifying the file name, make sure to use unique names, otherwise, the JTL contents may be appended to previous existing jtl files.</p></div><p>An additional option, specially targeted towards logging sample responses, is <code>responseFileSaver</code> which automatically generates a file for each received response. Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">responseFileSaver</span><span class="token punctuation">(</span><span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-response&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/listeners/ResponseFileSaver.java" target="_blank" rel="noopener noreferrer">ResponseFileSaver<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><p>Finally, if you have more specific needs that are not covered by previous examples, you can use <code>jsr223PostProcessor</code> to define your own custom logic like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;new File(&#39;traceFile&#39;) &lt;&lt; \&quot;${prev.sampleLabel}&gt;&gt;${prev.responseDataAsString}\\n\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslJsr223PostProcessor.java" target="_blank" rel="noopener noreferrer">DslJsr223PostProcessor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="real-time-metrics-visualization-and-historic-data-storage" tabindex="-1"><a class="header-anchor" href="#real-time-metrics-visualization-and-historic-data-storage" aria-hidden="true">#</a> Real-time metrics visualization and historic data storage</h3><p>When running tests with JMeter (and in particular with jmeter-java-dsl) a usual requirement is to be able to store such test runs in a persistent database to, later on, review such metrics, and compare different test runs. Additionally, jmeter-java-dsl only provides some summary data of a test run in the console while it is running, but, since it doesn&#39;t provide any sort of UI, this doesn&#39;t allow you to easily analyze such information as it can be done in JMeter GUI.</p><h4 id="influxdb" tabindex="-1"><a class="header-anchor" href="#influxdb" aria-hidden="true">#</a> InfluxDB</h4><p>To overcome these limitations you can use provided support for publishing JMeter test run metrics to <a href="https://www.influxdata.com/products/influxdb-overview/" target="_blank" rel="noopener noreferrer">InfluxDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> or <a href="https://www.elastic.co/what-is/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, which allows keeping a record of all run statistics and, through <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, get some nice dashboards like the following one:</p><p><img src="/jmeter-java-dsl/assets/grafana-ee0c26ae.png" alt="Grafana JMeter Dashboard Example"></p><p>This can be easily done using <code>influxDbListener</code>, an existing InfluxDB &amp; Grafana server, and using a dashboard like <a href="https://grafana.com/grafana/dashboards/4026" target="_blank" rel="noopener noreferrer">this one<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Here is an example test plan:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">influxDbListener</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8086/write?db=jmeter&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you want to try it locally, you can run <code>docker-compose up</code> (previously <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">installing Docker<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> in your machine) inside <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/reporting/real-time/influxdb" target="_blank" rel="noopener noreferrer">this directory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. After containers are started, you can open Grafana at <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Finally, run a performance test using the <code>influxDbListener</code> and you will be able to see the live results, and keep historic data. Cool, isn&#39;t it?!</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Use the provided <code>docker-compose</code> settings for local tests only. It uses weak credentials and is not properly configured for production purposes.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/listeners/InfluxDbBackendListener.java" target="_blank" rel="noopener noreferrer">InfluxDbBackendListener<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional details and settings.</p><h4 id="graphite" tabindex="-1"><a class="header-anchor" href="#graphite" aria-hidden="true">#</a> Graphite</h4><p>In a similar fashion to InfluxDB, you can use Graphite and Grafana. Here is an example test plan using the <code>graphiteListener</code>:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">graphiteListener</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:2004&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As in the InfluxDB scenario, you can try it locally by running <code>docker-compose up</code> (previously <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">installing Docker<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> in your machine) inside <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/reporting/real-time/graphite" target="_blank" rel="noopener noreferrer">this directory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. After containers are started, you can follow the same steps as in the InfluxDB scenario.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Use the provided <code>docker-compose</code> settings for local tests only. It uses weak credentials and is not properly configured for production purposes.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>graphiteListener</code> is configured to use Pickle Protocol, and port 2004, by default. This is more efficient than text plain protocol, which is the one used by default by JMeter.</p></div><h4 id="elasticsearch" tabindex="-1"><a class="header-anchor" href="#elasticsearch" aria-hidden="true">#</a> Elasticsearch</h4><p>Another alternative is using provided <code>jmeter-java-dsl-elasticsearch-listener</code> module with Elasticsearch and Grafana servers using a dashboard like <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/reporting/real-time/elasticsearch/grafana-provisioning/dashboards/jmeter.json" target="_blank" rel="noopener noreferrer">this one<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>To use the module, you will need to include the following dependency in your project:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-elasticsearch-listener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>repositories <span class="token punctuation">{</span>
    <span class="token punctuation">...</span>
    maven <span class="token punctuation">{</span> url <span class="token string">&#39;https://jitpack.io&#39;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token punctuation">...</span>
    testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-elasticsearch-listener:2.1&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And use provided <code>elasticsearchListener()</code> method like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchBackendListener</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">elasticsearchListener</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:9200/jmeter&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>This module uses <a href="https://github.com/delirius325/jmeter-elasticsearch-backend-listener" target="_blank" rel="noopener noreferrer">this JMeter plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> which, at its current version, has performance and dependency issues that might affect your project. <a href="https://github.com/delirius325/jmeter-elasticsearch-backend-listener/pull/109" target="_blank" rel="noopener noreferrer">This<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://github.com/delirius325/jmeter-elasticsearch-backend-listener/pull/110" target="_blank" rel="noopener noreferrer">this<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> pull requests fix those issues, but until they are merged and released, you might face such issues.</p></div><p>In the same fashion as InfluxDB, if you want to try it locally, you can run <code>docker-compose up</code> inside <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/reporting/real-time/elasticsearch" target="_blank" rel="noopener noreferrer">this directory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and follow similar steps <a href="#influxdb">as described for InfluxDB</a> to visualize live metrics in Grafana.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Use provided <code>docker-compose</code> settings for local tests only. It uses weak or no credentials and is not properly configured for production purposes.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-elasticsearch-listener/src/main/java/us/abstracta/jmeter/javadsl/elasticsearch/listener/ElasticsearchBackendListener.java" target="_blank" rel="noopener noreferrer">ElasticsearchBackendListener<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional details and settings.</p><h4 id="prometheus" tabindex="-1"><a class="header-anchor" href="#prometheus" aria-hidden="true">#</a> Prometheus</h4><p>As in previous scenarios, you can also use Prometheus and Grafana.</p><p>To use the module, you will need to include the following dependency in your project:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-prometheus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-prometheus:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And use provided <code>prometheusListener()</code> method like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>prometheus<span class="token punctuation">.</span></span><span class="token class-name">DslPrometheusListener</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">prometheusListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As in previous cases, you can to try it locally by running <code>docker-compose up</code> inside <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/reporting/real-time/prometheus" target="_blank" rel="noopener noreferrer">this directory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. After containers are started, you can follow the same steps as in previous scenarios.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Use the provided <code>docker-compose</code> settings for local tests only. It uses weak credentials and is not properly configured for production purposes.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-prometheus/src/main/java/us/abstracta/jmeter/javadsl/prometheus/DslPrometheusListener.java" target="_blank" rel="noopener noreferrer">DslPrometheusListener<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for details on listener settings.</p><p>Here is an example that shows the default settings used by <code>prometheusListener</code>:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>prometheus<span class="token punctuation">.</span></span><span class="token class-name">DslPrometheusListener</span><span class="token punctuation">.</span><span class="token class-name">PrometheusMetric</span></span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">prometheusListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">metrics</span><span class="token punctuation">(</span>
    <span class="token class-name">PrometheusMetric</span><span class="token punctuation">.</span><span class="token function">responseTime</span><span class="token punctuation">(</span><span class="token string">&quot;ResponseTime&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;the response time of samplers&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">labels</span><span class="token punctuation">(</span><span class="token class-name">PrometheusMetric</span><span class="token punctuation">.</span><span class="token constant">SAMPLE_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">PrometheusMetric</span><span class="token punctuation">.</span><span class="token constant">RESPONSE_CODE</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">quantile</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">quantile</span><span class="token punctuation">(</span><span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">quantile</span><span class="token punctuation">(</span><span class="token number">0.99</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">maxAge</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">PrometheusMetric</span><span class="token punctuation">.</span><span class="token function">successRatio</span><span class="token punctuation">(</span><span class="token string">&quot;Ratio&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;the success ratio of samplers&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">labels</span><span class="token punctuation">(</span><span class="token class-name">PrometheusMetric</span><span class="token punctuation">.</span><span class="token constant">SAMPLE_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">PrometheusMetric</span><span class="token punctuation">.</span><span class="token constant">RESPONSE_CODE</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token number">9270</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">endWait</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Note that the default settings are different from the used JMeter Prometheus Plugin, to allow easier usage and avoid missing metrics at the end of test plan execution.</p></blockquote><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When configuring the <code>prometheusListener</code> always consider setting a <code>endWait</code> that is greater thant the Prometheus Server configured <code>scrape_interval</code> to avoid missing metrics at the end of test plan execution (e.g.: 2x the scrape interval value).</p></div><h4 id="datadog" tabindex="-1"><a class="header-anchor" href="#datadog" aria-hidden="true">#</a> DataDog</h4><p>Another option is using <code>jmeter-java-dsl-datadog</code> module which uses existing <a href="https://github.com/DataDog/jmeter-datadog-backend-listener" target="_blank" rel="noopener noreferrer">jmeter-datadog-backend-listener plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to upload metrics to datadog which you can easily visualize and analize with <a href="https://app.datadoghq.com/integrations/jmeter?search=jmeter" target="_blank" rel="noopener noreferrer">DataDog provided JMeter dashboard<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Here is an example of what you get:</p><p><img src="/jmeter-java-dsl/assets/datadog-3aaf2aae.png" alt="datadog jmeter dashboard"></p><p>To use the module, just include the dependency:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-datadog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>repositories <span class="token punctuation">{</span>
    <span class="token punctuation">...</span>
    maven <span class="token punctuation">{</span> url <span class="token string">&#39;https://jitpack.io&#39;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token punctuation">...</span>
    testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-datadog:2.1&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And use provided <code>datadogListener()</code> method like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>datadog<span class="token punctuation">.</span></span><span class="token class-name">DatadogBackendListener</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">datadogBackendListener</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;DATADOG_APIKEY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you use a DataDog instance in a site different than US1 (the default one), you can use <code>.site(DatadogSite)</code> method to select the proper site.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can use <code>.resultsLogs(true)</code> to send results samples as logs to DataDog to get more information in DataDog on each sample of the test plan (for example for tracing). Enabling this property requires additional network traffic, that may affect test plan execution, and costs on DataDog, so use it sparingly.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can use <code>.tags()</code> to add additional information to metrics sent to DataDog. Check <a href="https://docs.datadoghq.com/getting_started/tagging/" target="_blank" rel="noopener noreferrer">DataDog documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p></div><h3 id="generate-html-reports-from-test-plan-execution" tabindex="-1"><a class="header-anchor" href="#generate-html-reports-from-test-plan-execution" aria-hidden="true">#</a> Generate HTML reports from test plan execution</h3><p>After running a test plan you would usually like to visualize the results in a friendly way that eases the analysis of collected information.</p><p>One, and preferred way, to do that is through <a href="#real-time-metrics-visualization-and-historic-data-storage">previously mentioned alternatives</a>.</p><p>Another way might just be using <a href="#simple-http-test-plan">previously introduced</a> <code>jtlWriter</code> and then loading the jtl file in JMeter GUI with one of JMeter provided listeners (like view results tree, summary report, etc.).</p><p>Another alternative is generating a standalone report for the test plan execution using jmeter-java-dsl provided <code>htmlReporter</code> like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">htmlReporter</span><span class="token punctuation">(</span><span class="token string">&quot;reports&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>htmlReporter</code> will create one directory for each generated report by applying the following template: <code>&lt;yyyy-MM-dd HH-mm-ss&gt; &lt;UUID&gt;</code>.</p><p>If you need a particular name for the report directory, for example for postprocessing logic (eg: adding CI build ID), you can use <code>htmlReporter(reportsDirectory, name)</code> to specify the name.</p><p>Make sure when specifying the name, for it to be unique, otherwise report generation will fail after test plan execution.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Time graphs by default group metrics per minute, but you can change this with provided <code>timeGraphsGranularity</code> method.</p></div><h3 id="live-built-in-graphs-and-stats" tabindex="-1"><a class="header-anchor" href="#live-built-in-graphs-and-stats" aria-hidden="true">#</a> Live built-in graphs and stats</h3><p>Sometimes you want to get live statistics on the test plan and don&#39;t want to install additional tools, and are not concerned about keeping historic data.</p><p>You can use <code>dashboardVisualizer</code> to get live charts and stats for quick review.</p><p>To use it, you need to add the following dependency:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-dashboard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-dashboard:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And use it as you would with any of the previously mentioned listeners (like <code>influxDbListener</code> and <code>jtlWriter</code>).</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>dashboard<span class="token punctuation">.</span></span><span class="token class-name">DashboardVisualizer</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token string">&quot;Group1&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;Sample 1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token string">&quot;Group2&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;Sample 2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://my.service/get&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">dashboardVisualizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>dashboardVisualizer</code> will pop up a window like the following one, which you can use to trace statistics while the test plan runs:</p><p><img src="/jmeter-java-dsl/assets/dashboard-777064cf.png" alt="Dashboard example window"></p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>The dashboard imposes additional resources (CPU &amp; RAM) consumption on the machine generating the load test, which may affect the test plan execution and reduce the number of concurrent threads you may reach in your machine. In general, prefer using one of the previously mentioned methods and using the dashboard just for local testing and quick feedback.</p><p><strong>Remember to remove it when is no longer needed in the test plan</strong></p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>The test will not end until you close all popup windows. This allows you to see the final charts and statistics of the plan before ending the test.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>As with <code>jtlWriter</code> and <code>influxDbListener</code>, you can place <code>dashboardVisualizer</code> at different levels of the test plan (at the test plan level, at the thread group level, as a child of a sampler, etc.), to only capture statistics of that particular part of the test plan.</p></div><h2 id="response-processing" tabindex="-1"><a class="header-anchor" href="#response-processing" aria-hidden="true">#</a> Response processing</h2><h3 id="check-for-expected-response" tabindex="-1"><a class="header-anchor" href="#check-for-expected-response" aria-hidden="true">#</a> Check for expected response</h3><p>By default, JMeter marks any HTTP request with a fail response code (4xx or 5xx) as failed, which allows you to easily identify when some request unexpectedly fails. But in many cases, this is not enough or desirable, and you need to check for the response body (or some other field) to contain (or not) a certain string.</p><p>This is usually accomplished in JMeter with the usage of Response Assertions, which provides an easy and fast way to verify that you get the proper response for each step of the test plan, marking the request as a failure when the specified condition is not met.</p><p>Here is an example of how to specify a response assertion in jmeter-java-dsl:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">responseAssertion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsSubstrings</span><span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/assertions/DslResponseAssertion.java" target="_blank" rel="noopener noreferrer">Response Assertion<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details and additional options.</p><p>For more complex scenarios check <a href="#change-sample-result-statuses-with-custom-logic">following section</a>.</p><h3 id="check-for-expected-json" tabindex="-1"><a class="header-anchor" href="#check-for-expected-json" aria-hidden="true">#</a> Check for expected JSON</h3><p>When checking for JSON responses, it is usually easier to just use <code>jsonAssertion</code>. Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsonAssertion</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Previous example just checks that sample result JSON contains an <code>id</code> field. You can use <code>matches(regex)</code>, <code>equalsTo(value)</code> or even <code>equalsToJson(json)</code> methods to check <code>id</code> associated value. Additionally, you can use the <code>not()</code> method to check for the inverse condition. E.g.: does not contain <code>id</code> field, or field value does not match a given regular expression or is not equal to a given value.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default this element uses JMeter JSON <a href="https://jmespath.org/" target="_blank" rel="noopener noreferrer">JMESPath<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Assertion element, and in consequence, JMESPath as query language.</p><p>If you want to use JMeter JSON Assertion element, and in consequence <a href="https://github.com/json-path/JsonPath" target="_blank" rel="noopener noreferrer">JSONPath<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> as the query language, you can simply use <code>.queryLanguage(JsonQueryLanguage.JSON_PATH)</code> and a JSONPath query.</p></div><h3 id="change-sample-result-statuses-with-custom-logic" tabindex="-1"><a class="header-anchor" href="#change-sample-result-statuses-with-custom-logic" aria-hidden="true">#</a> Change sample result statuses with custom logic</h3><p>Sometimes <a href="#check-for-expected-response">response assertions</a> and JMeter default behavior are not enough, and custom logic is required. In such scenarios you can use <code>jsr223PostProcessor</code> as in this example where the 429 status code is not considered as a fail status code:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;if (prev.responseCode == &#39;429&#39;) { prev.successful = true }&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also use a Java lambda instead of providing Groovy script, which benefits from Java type safety &amp; IDEs code auto-completion and consumes less CPU:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;429&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">setSuccessful</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Even though using Java Lambdas has several benefits, they are also less portable. Check <a href="#lambdas">following section</a> for more details.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslJsr223PostProcessor.java" target="_blank" rel="noopener noreferrer">DslJsr223PostProcessor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details and additional options.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>JSR223PostProcessor is a very powerful tool but is not the only, nor the best, alternative for many cases where JMeter already provides a better and simpler alternative. For instance, the previous example might be implemented with previously presented <a href="#check-for-expected-response">Response Assertion</a>.</p></div><h4 id="lambdas" tabindex="-1"><a class="header-anchor" href="#lambdas" aria-hidden="true">#</a> Lambdas</h4><p>As previously mentioned, using Java lambdas is in general more performant than using Groovy scripts (<a href="https://github.com/abstracta/jmeter-java-dsl/releases/tag/v1.14" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> are some comparisons) and are easier to develop and maintain due to type safety, IDE autocompletion, etc.</p><p>But, they are also <strong>less portable</strong>.</p><p>For instance, they will not work out of the box with remote engines (like <code>BlazeMeterEngine</code>) or while saving JMX and running it in standalone JMeter.</p><p>One option is using groovy scripts and <code>__groovy</code> function, but doing so, you lose the previously mentioned benefits.</p><p>Here is another approach to still benefit from Java code (vs Groovy script) and run in remote engines and standalone JMeter.</p><h5 id="lambdas-in-remote-engine" tabindex="-1"><a class="header-anchor" href="#lambdas-in-remote-engine" aria-hidden="true">#</a> Lambdas in remote engine</h5><p>Here are the steps to run test plans containing Java lambdas in <code>BlazeMeterEngine</code>:</p><ol><li><p>Replace all Java lambdas with public static classes implementing proper script interface.</p><p>For example, if you have the following test:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;429&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">setSuccessful</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can change it to:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">StatusSuccessProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">PostProcessorScript</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runScript</span><span class="token punctuation">(</span><span class="token class-name">PostProcessorVars</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;429&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">setSuccessful</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span><span class="token class-name">StatusSuccessProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Script interface to implement, depends on where you use the lambda code. Available interfaces are <code>PropertyScript</code>, <code>PreProcessorScript</code>, <code>PostProcessorScript</code>, and <code>SamplerScript</code>.</p></blockquote></li><li><p>Upload your test code and dependencies to BlazeMeter.</p><p>If you use maven, here is what you can add to your project to configure this:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token comment">&lt;!-- this generates a jar containing your test code (including the public static class previously mentioned) --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>test-jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- this copies project dependencies to target/libs directory --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-dependency-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>copy-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>copy-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>${project.build.directory}/libs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- include here, separating by commas, any additional dependencies (just the artifacts ids) you need to upload to BlazeMeter --&gt;</span>
          <span class="token comment">&lt;!-- AzureEngine automatically uploads JMeter dsl artifacts, so only transitive or custom dependencies would be required --&gt;</span>
          <span class="token comment">&lt;!-- if you would like for BlazeMeterEngine and OctoPerfEngine to automatically upload JMeter DSL artifacts, please create an issue in GitHub repository --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeArtifactIds</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeArtifactIds</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- this takes care of executing tests classes ending with IT after test jar is generated and dependencies are copied --&gt;</span>
  <span class="token comment">&lt;!-- additionally, it sets some system properties as to easily identify test jar file --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-failsafe-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0-M7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>systemPropertyVariables</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testJar.path</span><span class="token punctuation">&gt;</span></span>${project.build.directory}/${project.artifactId}-${project.version}-tests.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testJar.path</span><span class="token punctuation">&gt;</span></span> 
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>systemPropertyVariables</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>integration-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>verify<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Additionally, rename your test class to use IT suffix (so it runs after test jar is created and dependencies are copied), and add to <code>BlazeMeterEngine</code> logic to upload the jars. For example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Here we renamed from PerformanceTest to PerformanceIT</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceIT</span> <span class="token punctuation">{</span>
  
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token function">testPlan</span><span class="token punctuation">(</span>
              <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">assets</span><span class="token punctuation">(</span><span class="token function">findAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> libsFiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;target/libs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ret <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">[</span>libsFiles<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      ret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;testJar.path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>libsFiles<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ret<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> libsFiles<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Currently only <code>BlazeMeterEngine</code> and <code>AzureEngine</code> provide a way to upload assets. If you need support for other engines, please request it <a href="https://github.com/abstracta/issues" target="_blank" rel="noopener noreferrer">in an issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div></li><li><p>Execute your tests with maven (either with <code>mvn clean verify</code> or as part of <code>mvn clean install</code>) or IDE (by first packaging your project, and then executing <code>PerformanceIT</code> test).</p></li></ol><h5 id="lambdas-in-standalone-jmeter" tabindex="-1"><a class="header-anchor" href="#lambdas-in-standalone-jmeter" aria-hidden="true">#</a> Lambdas in standalone JMeter</h5><p>If you save your test plan with the <code>saveAsJmx()</code> test plan method and then want to execute the test plan in JMeter, you will need to:</p><ol><li><p>Replace all Java lambdas with public static classes implementing proper script interface.</p><p>Same as the previous section.</p></li><li><p>Package your test code in a jar.</p><p>Same as the previous section.</p></li><li><p>Copy all dependencies, in addition to <code>jmeter-java-dsl</code>, required by the lambda code to JMeter <code>lib/ext</code> folder.</p><p>You can also use <code>maven-dependency-plugin</code> and run <code>mvn package -DskipTests</code> to get the actual jars. If the test plan requires any particular jmeter plugin, then you would need to copy those as well.</p></li></ol><h3 id="use-part-of-a-response-in-a-subsequent-request-aka-correlation" tabindex="-1"><a class="header-anchor" href="#use-part-of-a-response-in-a-subsequent-request-aka-correlation" aria-hidden="true">#</a> Use part of a response in a subsequent request (aka correlation)</h3><p>It is a usual requirement while creating a test plan for an application to be able to use part of a response (e.g.: a generated ID, token, etc.) in a subsequent request. This can be easily achieved using JMeter extractors and variables.</p><h4 id="regular-expressions-extraction" tabindex="-1"><a class="header-anchor" href="#regular-expressions-extraction" aria-hidden="true">#</a> Regular expressions extraction</h4><p>Here is an example with jmeter-java-dsl using regular expressions:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslRegexExtractor.java" target="_blank" rel="noopener noreferrer">DslRegexExtractor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details and additional options.</p><h4 id="boundaries-based-extraction" tabindex="-1"><a class="header-anchor" href="#boundaries-based-extraction" aria-hidden="true">#</a> Boundaries based extraction</h4><p>Regular expressions are quite powerful and flexible, but also are complex and performance might not be optimal in some scenarios. When you know that desired extraction is always surrounded by some specific text that never varies, then you can use <code>boundaryExtractor</code> which is simpler and in many cases more performant:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">boundaryExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslBoundaryExtractor.java" target="_blank" rel="noopener noreferrer">DslBoundaryExtractor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details and additional options.</p><h4 id="json-extraction" tabindex="-1"><a class="header-anchor" href="#json-extraction" aria-hidden="true">#</a> JSON extraction</h4><p>When the response of a request is JSON, then you can use <code>jsonExtractor</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsonExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default this element uses JMeter JSON <a href="https://jmespath.org/" target="_blank" rel="noopener noreferrer">JMESPath<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Extractor element, and in consequence JMESPath as query language.</p><p>If you want to use JMeter JSON Extractor element, and in consequence <a href="https://github.com/json-path/JsonPath" target="_blank" rel="noopener noreferrer">JSONPath<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> as query language, you can simply use <code>.queryLanguage(JsonQueryLanguage.JSON_PATH)</code> and a JSONPath query.</p></div><h2 id="requests-generation" tabindex="-1"><a class="header-anchor" href="#requests-generation" aria-hidden="true">#</a> Requests generation</h2><h3 id="conditionals" tabindex="-1"><a class="header-anchor" href="#conditionals" aria-hidden="true">#</a> Conditionals</h3><p>At some point, you will need to execute part of a test plan according to a certain condition (eg: a value extracted from a previous request). When you reach that point, you can use <code>ifController</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">ifController</span><span class="token punctuation">(</span><span class="token string">&quot;${__groovy(vars[&#39;ACCOUNT_ID&#39;] != null)}&quot;</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also use a Java lambda instead of providing JMeter expression, which benefits from Java type safety &amp; IDEs code auto-completion and consumes less CPU:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">ifController</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Even though using Java Lambdas has several benefits, they are also less portable. Check <a href="#lambdas">this section</a> for more details.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslIfController.java" target="_blank" rel="noopener noreferrer">DslIfController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://jmeter.apache.org/usermanual/component_reference.html#If_Controller" target="_blank" rel="noopener noreferrer">JMeter Component documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="loops" tabindex="-1"><a class="header-anchor" href="#loops" aria-hidden="true">#</a> Loops</h3><h4 id="iterating-over-extracted-values" tabindex="-1"><a class="header-anchor" href="#iterating-over-extracted-values" aria-hidden="true">#</a> Iterating over extracted values</h4><p>A common use case is to iterate over a list of values extracted from a previous request and execute part of the plan for each extracted value. This can be easily done using <code>foreachController</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> productsIdVarName <span class="token operator">=</span> <span class="token string">&quot;PRODUCT_IDS&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> productIdVarName <span class="token operator">=</span> <span class="token string">&quot;PRODUCT_ID&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> productsPath <span class="token operator">=</span> <span class="token string">&quot;/products&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span>productsPath<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsonExtractor</span><span class="token punctuation">(</span>productsIdVarName<span class="token punctuation">,</span> <span class="token string">&quot;[].id&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">matchNumber</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">forEachController</span><span class="token punctuation">(</span>productsIdVarName<span class="token punctuation">,</span> productIdVarName<span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span>productsPath <span class="token operator">+</span> <span class="token string">&quot;/${&quot;</span> <span class="token operator">+</span> productIdVarName <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>JMeter automatically generates a variable <code>__jm__&lt;loopName&gt;__idx</code> with the current index of the for each iteration (starting with 0), which you can use in controller children elements if needed. The default name for the for each controller, when not specified, is <code>foreach</code>.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslForEachController.java" target="_blank" rel="noopener noreferrer">DslForEachController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h4 id="iterating-while-a-condition-is-met" tabindex="-1"><a class="header-anchor" href="#iterating-while-a-condition-is-met" aria-hidden="true">#</a> Iterating while a condition is met</h4><p>If at any time you want to execute a given part of a test plan, inside a thread iteration, while a condition is met, then you can use <code>whileController</code> (internally using <a href="https://jmeter.apache.org/usermanual/component_reference.html#While_Controller" target="_blank" rel="noopener noreferrer">JMeter While Controller<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>) like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">whileController</span><span class="token punctuation">(</span><span class="token string">&quot;${__groovy(vars[&#39;ACCOUNT_ID&#39;] == null)}&quot;</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                        <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As with <code>ifController</code>, you can also use Java lambdas to benefit from IDE auto-completion and type safety and less CPU consumption. Eg:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">whileController</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
        <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Even though using Java Lambdas has several benefits, they are also less portable. Check <a href="#lambdas">this section</a> for more details.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>JMeter evaluates while conditions before entering each iteration, and after exiting each iteration. Take this into consideration if the condition has side effects (eg: incrementing counters, altering some other state, etc).</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>JMeter automatically generates a variable <code>__jm__&lt;loopName&gt;__idx</code> with the current index of while iteration (starting with 0). Example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">whileController</span><span class="token punctuation">(</span><span class="token string">&quot;items&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;${__groovy(vars.getObject(&#39;__jm__items__idx&#39;) &lt; 4)}&quot;</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;My Item\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The default name for the while controller, when not specified, is <code>while</code>.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslWhileController.java" target="_blank" rel="noopener noreferrer">DslWhileController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h4 id="iterating-a-fixed-number-of-times" tabindex="-1"><a class="header-anchor" href="#iterating-a-fixed-number-of-times" aria-hidden="true">#</a> Iterating a fixed number of times</h4><p>In simple scenarios where you just want to execute a fixed number of times, within a thread group iteration, a given part of the test plan, you can just use <code>forLoopController</code> (which uses <a href="https://jmeter.apache.org/usermanual/component_reference.html#Loop_Controller" target="_blank" rel="noopener noreferrer">JMeter Loop Controller component<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>) as in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">forLoopController</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will result in 10 * 5 = 50 requests to the given URL for each thread in the thread group.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>JMeter automatically generates a variable <code>__jm__&lt;loopName&gt;__idx</code> with the current index of for loop iteration (starting with 0) which you can use in children elements. The default name for the for loop controller, when not specified, is <code>for</code>.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/ForLoopController.java" target="_blank" rel="noopener noreferrer">ForLoopController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h4 id="iterating-for-a-given-period" tabindex="-1"><a class="header-anchor" href="#iterating-for-a-given-period" aria-hidden="true">#</a> Iterating for a given period</h4><p>In some scenarios you might want to execute a given logic until all the steps are executed or a given period of time has passed. In these scenarios you can use <code>runtimeController</code> which stops executing children elements when a specified time is reached.</p><p>Here is an example which makes requests to a page until token expires by using <code>runtimeController</code> in combination with <code>whileController</code>.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Duration</span> tokenExpiration <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">runtimeController</span><span class="token punctuation">(</span>tokenExpiration<span class="token punctuation">,</span>
                <span class="token function">whileController</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
                    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslRuntimeController.java" target="_blank" rel="noopener noreferrer">DslRuntimeController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h4 id="execute-only-once-in-thread" tabindex="-1"><a class="header-anchor" href="#execute-only-once-in-thread" aria-hidden="true">#</a> Execute only once in thread</h4><p>In some cases, you only need to run part of a test plan once. For these need, you can use <code>onceOnlyController</code>. This controller will execute a part of the test plan only one time on the first iteration of each thread (using <a href="https://jmeter.apache.org/usermanual/component_reference.html#Once_Only_Controller" target="_blank" rel="noopener noreferrer">JMeter Once Only Controller Component<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>).</p><p>You can use this, for example, for one-time authorization or for setting JMeter variables or properties.</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HTTPConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDslTest</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DslOnceOnlyControllerTest</span> <span class="token keyword">extends</span> <span class="token class-name">JmeterDslTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldExecuteOnlyOneTimeWhenOnceOnlyControllerInPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">onceOnlyController</span><span class="token punctuation">(</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/login&quot;</span><span class="token punctuation">)</span> <span class="token comment">// only runs once</span>
                    <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Basic asdf=&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                        <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;AUTH_TOKEN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authToken=(.*)&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span> <span class="token comment">// runs ten times</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bearer ${AUTH_TOKEN}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslOnceOnlyController.java" target="_blank" rel="noopener noreferrer">DslOnceOnlyController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="group-requests" tabindex="-1"><a class="header-anchor" href="#group-requests" aria-hidden="true">#</a> Group requests</h3><p>Sometimes, is necessary to be able to group requests which constitute different steps in a test. For example, to separate necessary requests to do a login from the ones used to add items to the cart and the ones to do a purchase. JMeter (and the DSL) provide Transaction Controllers for this purpose, here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token char">&#39;login&#39;</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/login&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;user=test&amp;password=test&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_FORM_URLENCODED</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">transaction</span><span class="token punctuation">(</span>&#39;addItemToCart&#39;<span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/items&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;id\&quot;: 1}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will provide additional sample results for each transaction, which contain the aggregate metrics for containing requests, allowing you to focus on the actual flow steps instead of each particular request.</p><p>If you don&#39;t want to generate additional sample results (and statistics), and want to group requests for example to apply a given timer, config, assertion, listener, pre- or post-processor, then you can use <code>simpleController</code> like in following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">simpleController</span><span class="token punctuation">(</span><span class="token char">&#39;login&#39;</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">responseAssertion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">containsSubstrings</span><span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can even use <code>transactionController</code> and <code>simpleController</code> to easily modularize parts of your test plan into Java methods (or classes) like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>controllers<span class="token punctuation">.</span></span><span class="token class-name">DslTransactionController</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">DslTransactionController</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;user=test&amp;password=test&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_FORM_URLENCODED</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token class-name">DslTransactionController</span> <span class="token function">addItemToCart</span><span class="token punctuation">(</span><span class="token class-name">String</span> baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;addItemToCart&quot;</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/cart/items&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;id\&quot;: 1}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> baseUrl <span class="token operator">=</span> <span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">login</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">addItemToCart</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="csv-as-input-data-for-requests" tabindex="-1"><a class="header-anchor" href="#csv-as-input-data-for-requests" aria-hidden="true">#</a> CSV as input data for requests</h3><p>Sometimes is necessary to run the same flow but using different pre-defined data on each request. For example, a common use case is to use a different user (from a given set) in each request.</p><p>This can be easily achieved using the provided <code>csvDataSet</code> element. For example, having a file like this one:</p><div class="language-csv line-numbers-mode" data-ext="csv"><pre class="language-csv"><code><span class="token value">USER</span><span class="token punctuation">,</span><span class="token value">PASS</span>
<span class="token value">user1</span><span class="token punctuation">,</span><span class="token value">pass1</span>
<span class="token value">user2</span><span class="token punctuation">,</span><span class="token value">pass2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can implement a test plan that tests recurrent login with the two users with something like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HTTPConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">csvDataSet</span><span class="token punctuation">(</span><span class="token string">&quot;users.csv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/login&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;${USER}\&quot;: \&quot;${PASS}\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/logout&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>To properly format the data in your CSV, a general rule you can apply is to replace each double quotes with two double quotes and add double quotes to the beginning and end of each CSV value.</p><p>E.g.: if you want one CSV field to contain the value <code>{&quot;field&quot;: &quot;value&quot;}</code>, then use <code>&quot;{&quot;&quot;field:&quot;&quot;: &quot;&quot;value&quot;&quot;}&quot;</code>.</p><p>This way, with a simple search and replace, you can include in a CSV field any format like JSON, XML, etc.</p><p>Note: JMeter uses should be aware that JMeter DSL <code>csvDataSet</code> sets <code>Allowed quoted data?</code> flag, in associated <code>Csv Data Set Config</code> element, to <code>true</code>.</p></div><p>By default, the CSV file will be opened once and shared by all threads. This means that when one thread reads a CSV line in one iteration, then the following thread reading a line will continue with the following line.</p><p>If you want to change this (to share the file per thread group or use one file per thread), then you can use the provided <code>sharedIn</code> method like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>configs<span class="token punctuation">.</span></span><span class="token class-name">DslCsvDataSet</span><span class="token punctuation">.</span><span class="token class-name">Sharing</span></span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">csvDataSet</span><span class="token punctuation">(</span><span class="token string">&quot;users.csv&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sharedIn</span><span class="token punctuation">(</span><span class="token class-name">Sharing</span><span class="token punctuation">.</span><span class="token constant">THREAD</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/login&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;${USER}\&quot;: \&quot;${PASS}\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/logout&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>:::</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>You can use the <code>randomOrder()</code> method to get CSV lines in random order (using <a href="https://github.com/Blazemeter/jmeter-bzm-plugins/blob/master/random-csv-data-set/RandomCSVDataSetConfig.md" target="_blank" rel="noopener noreferrer">Random CSV Data Set plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>), but this is less performant as getting them sequentially, so use it sparingly.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/configs/DslCsvDataSet.java" target="_blank" rel="noopener noreferrer">DslCsvDataSet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional details and options (like changing delimiter, handling files without headers line, stopping on the end of file, etc.).</p><h3 id="counter" tabindex="-1"><a class="header-anchor" href="#counter" aria-hidden="true">#</a> Counter</h3><p>In scenarios that you need unique value for each request, for example for id parameters, you can use <code>counter</code> which provides easy means to have an auto incremental value that can be used in requests.</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">counter</span><span class="token punctuation">(</span><span class="token string">&quot;USER_ID&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">startingValue</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// will generate 1000, 1001, 1002...</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span>wiremockUri <span class="token operator">+</span> <span class="token string">&quot;/${USER_ID}&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/configs/DslCounter.java" target="_blank" rel="noopener noreferrer">DslCounter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="provide-request-parameters-programmatically-per-request" tabindex="-1"><a class="header-anchor" href="#provide-request-parameters-programmatically-per-request" aria-hidden="true">#</a> Provide request parameters programmatically per request</h3><p>So far we have seen a few ways to generate requests with information extracted from CSV or through a counter, but this is not enough for some scenarios. When you need more flexibility and power you can use <code>jsr223preProcessor</code> to specify your own logic to build each request.</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span><span class="token class-name">JMeterVariables</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;${REQUEST_BODY}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">TEXT_PLAIN</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsr223PreProcessor</span><span class="token punctuation">(</span><span class="token string">&quot;vars.put(&#39;REQUEST_BODY&#39;, &quot;</span> <span class="token operator">+</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> <span class="token string">&quot;.buildRequestBody(vars))&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span><span class="token class-name">JMeterVariables</span> vars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> countVarName <span class="token operator">=</span> <span class="token string">&quot;REQUEST_COUNT&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> countVar <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> vars<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>countVarName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> countVar <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> countVar <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
    vars<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>countVarName<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;MyBody&quot;</span> <span class="token operator">+</span> count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also use a Java lambda instead of providing Groovy script, which benefits from Java type safety &amp; IDEs code auto-completion and consumes less CPU:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">jsr223PreProcessor</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;REQUEST_BODY&quot;</span><span class="token punctuation">,</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Or even use this shorthand:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">post</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">TEXT_PLAIN</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Even though using Java Lambdas has several benefits, they are also less portable. Check <a href="#lambdas">this section</a> for more details.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>jsr223PreProcessor</code> is quite powerful. But, provided example can easily be achieved through the usage of <a href="#counter">counter element</a>.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/preprocessors/DslJsr223PreProcessor.java" target="_blank" rel="noopener noreferrer">DslJsr223PreProcessor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> &amp; <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/http/DslHttpSampler.java" target="_blank" rel="noopener noreferrer">DslHttpSampler<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details and additional options.</p><h3 id="timers" tabindex="-1"><a class="header-anchor" href="#timers" aria-hidden="true">#</a> Timers</h3><h4 id="emulate-user-delays-between-requests" tabindex="-1"><a class="header-anchor" href="#emulate-user-delays-between-requests" aria-hidden="true">#</a> Emulate user delays between requests</h4><p>Sometimes, is necessary to be able to properly replicate users&#39; behavior, and in particular the time the users take between sending one request and the following one. For example, to simulate the time it will take to complete a purchase form. JMeter (and the DSL) provide a few alternatives for this.</p><p>If you just want to add 1 pause between two requests, you can use the <code>threadPause</code> method like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">threadPause</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/selected-items&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;id\&quot;: 1}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Using <code>threadPause</code> is a good solution for adding individual pauses, but if you want to add pauses across several requests, or sections of test plan, then using a <code>constantTimer</code> or <code>uniformRandomTimer</code> is better. Here is an example that adds a delay of between 4 and 10 seconds for every request in the test plan:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">uniformRandomTimer</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;addItemToCart&quot;</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/selected-items&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;id\&quot;: 1}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;checkout&quot;</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/chekout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/checkout/userinfo&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;{\&quot;Name\&quot;: Dave, \&quot;lastname\&quot;: Tester, \&quot;Street\&quot;: 1483  Smith Road, \&quot;City\&quot;: Atlanta}&quot;</span><span class="token punctuation">,</span>
                        <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>As you may have noticed, timer order in relation to samplers, doesn&#39;t matter. Timers apply to all samplers in their scope, adding a pause after pre-processor executions and before the actual sampling. <code>threadPause</code> order, on the other hand, is relevant, and the pause will only execute when previous samplers in the same scope have run and before following samplers do.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>uniformRandomTimer</code> <code>minimum</code> and <code>maximum</code> parameters differ from the ones used by JMeter Uniform Random Timer element, to make it simpler for users with no JMeter background.</p><p>The generated JMeter test element uses the <code>Constant Delay Offset</code> set to <code>minimum</code> value, and the <code>Maximum random delay</code> set to <code>(maximum - minimum)</code> value.</p></div><h4 id="control-throughput" tabindex="-1"><a class="header-anchor" href="#control-throughput" aria-hidden="true">#</a> Control throughput</h4><p>To achieve a specific constant throughput for specific samplers or section of a test plan, you can use <code>throughputTimer</code>, which uses JMeter <code>ConstantThroughputTimer</code>.</p><p>Here is an example for generating a maximum of 120 samples per minute:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">throughputTimer</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> 
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, <code>throughtputTimer</code> will control throughput among active threads. If you want to control throughput per thread, i.e. each thread generating the specified throughput, which means that <code>totalThoughput = configuredThroughput * numberOfThreads</code>, you can use <code>perThread()</code> method.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>The placement (scope) of the <code>throughputTimer</code> will determine its behaviour. E.g. if you place the timer inside an <code>ifController</code>, it will only control the execution throughput only for elements inside the <code>ifController</code>, or if you place it inside a <code>threadGroup</code> other thread groups execution will be directly not affected (nor they would directly affect this timer execution).</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>The timer uses by default even distribution of throughput among the active threads. This means that if you have 10 threads and specify 10 tpm, then each thread will try to execute at 1tpm, not adjusting each thread tpm if some other thread was far from achieving the configured tpm. If you want more precise throughput control, you can use <code>.calculation()</code> method, for example, with <code>THREAD_GROUP_ACCURATE</code>, but doing so, may lead to unexpected behavior when using multiple timers in same thread group.</p><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/timers/DslThroughputTimer.java" target="_blank" rel="noopener noreferrer">DslThroughputTimer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>throughputTimer</code> works by pausing requests to achieve a constant throughput, so the response times and number of threads must be sufficient to achieve the target throughput. You can think of this timer as a way to limit the maximum throughput, but it does have no way to generate more load if response times are high and threads are not enough. To automatically adjust threads when response times are high you can use <code>rpsThreadGroup</code> as described <a href="#throughput-based-thread-group">here</a>.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>On first invocation of <code>throughputTimer</code> on each thread, no delay will be generated by the timer, which may lead to initially higher throughput than expected.</p><p>For example, in previously provided example, 10 requests (1 for each thread) will run without &quot;throughput control&quot;, which means you will get 10 requests at once, and after that, you will get 1 request per second (as expected).</p></div><h4 id="requests-synchronization" tabindex="-1"><a class="header-anchor" href="#requests-synchronization" aria-hidden="true">#</a> Requests synchronization</h4><p>Usually, samples generated by different threads in a test plan thread group start deviating from each other according to the different durations each of them may experience.</p><p>Here is a diagram depicting this behavior, extracted from <a href="https://github.com/abstracta/jmeter-java-dsl/discussions/204" target="_blank" rel="noopener noreferrer">this nice example<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> provided by one of JMeter DSL users:</p><p><img src="/jmeter-java-dsl/assets/not-synchronized-samples-483d50c1.png" alt="not synchronized samples in 2 threads and 3 iterations"></p><p>In most cases this is ok. But, if you want to generate batches of simultaneous requests to a system under test, this variability will prevent you from getting the expected behavior.</p><p>So, to synchronize requests, by holding some of them until all are in sync, like in this diagram:</p><p><img src="/jmeter-java-dsl/assets/synchronized-samples-3256a15e.png" alt="synchronized samples in 2 threads and 3 iterations"></p><p>You can use <code>synchronizingTimer</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token function">httpSample</span><span class="token punctuation">(</span><span class="token string">&quot;https://mysite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">synchronizingTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="execute-part-of-a-test-plan-part-a-fraction-of-the-times" tabindex="-1"><a class="header-anchor" href="#execute-part-of-a-test-plan-part-a-fraction-of-the-times" aria-hidden="true">#</a> Execute part of a test plan part a fraction of the times</h3><p>In some cases, you may want to execute a given part of the test plan not in every iteration, and only for a given percent of times, to emulate certain probabilistic nature of the flow the users execute.</p><p>In such scenarios, you may use <code>percentController</code>, which uses JMeter Throughput Controller to achieve exactly that.</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">percentController</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token comment">// run this 40% of the times</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/poll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">percentController</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token comment">// run this 70% of the times</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/PercentController.java" target="_blank" rel="noopener noreferrer">PercentController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="switch-between-test-plan-parts-with-a-given-probability" tabindex="-1"><a class="header-anchor" href="#switch-between-test-plan-parts-with-a-given-probability" aria-hidden="true">#</a> Switch between test plan parts with a given probability</h3><p>In some cases, you need to switch in a test plan between different behaviors assigning to them different probabilities. The main difference between this need and the previous one is that in each iteration you have to execute one of the parts, while in the previous case you might get multiple or no part executed on a given iteration.</p><p>For this scenario you can use <code>weightedSwitchCotroller</code>, like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">weightedSwitchController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice/1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// will run 30/(30+20)=60% of the iterations</span>
                <span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice/2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// will run 20/(30+20)=40% of the iterations</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslWeightedSwitchController.java" target="_blank" rel="noopener noreferrer">DslWeightedSwitchController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="parallel-requests" tabindex="-1"><a class="header-anchor" href="#parallel-requests" aria-hidden="true">#</a> Parallel requests</h3><p>JMeter provides two main ways for running requests in parallel: thread groups and HTTP samplers downloading embedded resources in parallel. But in some cases is necessary to run requests in parallel which can&#39;t be properly modeled with previously mentioned scenarios. For such cases, you can use <code>paralleController</code> which allows using the <a href="https://github.com/Blazemeter/jmeter-bzm-plugins/blob/master/parallel/Parallel.md" target="_blank" rel="noopener noreferrer">Parallel Controller plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to execute a given set of requests in parallel (while in a JMeter thread iteration step).</p><p>To use it, add the following dependency to your project:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-parallel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-dashboard:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And use it, like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>parallel<span class="token punctuation">.</span></span><span class="token class-name">ParallelController</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">parallelController</span><span class="token punctuation">(</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/poll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>By default, the controller has no limit on the number of parallel requests per JMeter thread. You can set a limit by using provided <code>maxThreads(int)</code> method. Additionally, you can opt to aggregate children&#39;s results in a parent sampler using <code>generateParentSample(boolean)</code> method, in a similar fashion to the transaction controller.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When requesting embedded resources of an HTML response, prefer using <code>downloadEmbeddedResources()</code> method in <code>httpSampler</code> instead. Likewise, when you just need independent parts of a test plan to execute in parallel, prefer using different thread groups for each part.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-parallel/src/main/java/us/abstracta/jmeter/javadsl/parallel/ParallelController.java" target="_blank" rel="noopener noreferrer">ParallelController<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional info.</p><h2 id="jmeter-variables-properties" tabindex="-1"><a class="header-anchor" href="#jmeter-variables-properties" aria-hidden="true">#</a> JMeter variables &amp; properties</h2><h3 id="variables" tabindex="-1"><a class="header-anchor" href="#variables" aria-hidden="true">#</a> Variables</h3><p>In general, when you want to reuse a certain value of your script, you can, and is the preferred way, just to use Java variables. In some cases though, you might need to pre-initialize some JMeter thread variable (for example to later be used in an <code>ifController</code>) or easily update its value without having to use a jsr223 element for that. For these cases, the DSL provides the <code>vars()</code> method.</p><p>Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> pageVarName <span class="token operator">=</span> <span class="token string">&quot;PAGE&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> firstPage <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> endPage <span class="token operator">=</span> <span class="token string">&quot;END&quot;</span><span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pageVarName<span class="token punctuation">,</span> firstPage<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">ifController</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token operator">!</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pageVarName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>endPage<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts?page=${&quot;</span> <span class="token operator">+</span> pageVarName <span class="token operator">+</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                        <span class="token function">regexExtractor</span><span class="token punctuation">(</span>pageVarName<span class="token punctuation">,</span> <span class="token string">&quot;next=.*?page=(\\d+)&quot;</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span>endPage<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">ifController</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pageVarName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>endPage<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pageVarName<span class="token punctuation">,</span> firstPage<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>For special consideration of existing JMeter users:</p><p><code>vars()</code> internally uses JMeter User Defined Variables (aka UDV) when placed as a test plan child, but a JSR223 sampler otherwise. This decision avoids several non-intuitive behaviors of JMeter UDV which are listed in red blocks in <a href="https://jmeter.apache.org/usermanual/component_reference.html#User_Defined_Variables" target="_blank" rel="noopener noreferrer">the JMeter component documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Internally using a JSR223 sampler, allows DSL users to properly scope a variable to where it is placed (eg: defining a variable in one thread has no effect on other threads or thread groups), set the value when it&#39;s actually needed (not just at the beginning of test plan execution), and support cross-variable references (i.e.: if <code>var1=test</code> and <code>var2=${var1}</code>, then the value of <code>var2</code> would be solved to <code>test</code>).</p><p>When <code>vars()</code> is located as a direct child of the test plan, due to the usage of UDV, declared variables will be available to all thread groups and no variable cross-reference is supported.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/configs/DslVariables.java" target="_blank" rel="noopener noreferrer">DslVariables<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><h3 id="properties" tabindex="-1"><a class="header-anchor" href="#properties" aria-hidden="true">#</a> Properties</h3><p>You might reach a point where you want to pass some parameter to the test plan or want to share some object or data that is available for all threads to use. In such scenarios, you can use JMeter properties.</p><p>JMeter properties is a map of keys and values, that is accessible to all threads. To access them you can use <code>${__P(PROPERTY_NAME)}</code> or equivalent <code>${__property(PROPERTY_NAME)</code> inside almost any string, <code>props[&#39;PROPERTY_NAME&#39;]</code> inside groovy scripts or <code>props.get(&quot;PROPERTY_NAME&quot;)</code> in lambda expressions.</p><p>To set them, you can use <code>prop()</code> method included in <code>EmbeddedJmeterEngine</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engines<span class="token punctuation">.</span></span><span class="token class-name">EmbeddedJmeterEngine</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://myservice.test/${__P(MY_PROP)}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EmbeddedJmeterEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&quot;MY_PROP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MY_VAL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Or you can set them in groovy or java code, like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">jsr223Sampler</span><span class="token punctuation">(</span><span class="token string">&quot;props.put(&#39;MY_PROP&#39;, &#39;MY_VAL&#39;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://myservice.test/${__P(MY_PROP)}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Or you can even load them from a file, which might be handy to have different files with different values for different execution profiles (eg: different environments). Eg:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engines<span class="token punctuation">.</span></span><span class="token class-name">EmbeddedJmeterEngine</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://myservice.test/${__P(MY_PROP)}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EmbeddedJmeterEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">propertiesFile</span><span class="token punctuation">(</span><span class="token string">&quot;my.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can put any object (not just strings) in properties, but only strings can be accessed via <code>${__P(PROPERTY_NAME)}</code> and <code>${__property(PROPERTY_NAME)}</code>.</p><p>Being able to put any kind of object allows you to do very powerful stuff, like implementing a custom cache, or injecting some custom logic to a test plan.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can also specify properties through JVM system properties either by setting JVM parameter <code>-D</code> or using <code>System.setProperty()</code> method.</p><p>When properties are set as JVM system properties, they are not accessible via <code>props[PROPERTY_NAME]</code> or <code>props.get(&quot;PROPERTY_NAME&quot;)</code>. If you need to access them from groovy or java code, then use <code>props.getProperty(&quot;PROPERTY_NAME&quot;)</code> instead.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>JMeter properties can currently only be used with <code>EmbeddedJmeterEngine</code>, so use them sparingly and prefer other mechanisms when available.</p></div><h2 id="test-resources" tabindex="-1"><a class="header-anchor" href="#test-resources" aria-hidden="true">#</a> Test resources</h2><p>When working with tests in maven projects, even gradle in some scenarios, it is usually necessary to use files hosted in <code>src/test/resources</code>. For example CSV files for <code>csvDataSet</code>, a file to be used by an <code>httpSampler</code>, some JSON for comparison, etc. The DSL provides <code>testResource</code> as a handy shortcut for such scenarios. Here is a simple example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">csvDataSet</span><span class="token punctuation">(</span><span class="token function">testResource</span><span class="token punctuation">(</span><span class="token string">&quot;users.csv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// gets users info from src/test/resources/users.csv</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://myservice.test/users/${USER_ID}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/util/TestResource.java" target="_blank" rel="noopener noreferrer">TestResource<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for some further details.</p><h2 id="protocols" tabindex="-1"><a class="header-anchor" href="#protocols" aria-hidden="true">#</a> Protocols</h2><h3 id="http" tabindex="-1"><a class="header-anchor" href="#http" aria-hidden="true">#</a> HTTP</h3><p>Throughout this guide, several examples have been shown for simple cases of HTTP requests (mainly how to do gets and posts), but the DSL provides additional features that you might need to be aware of.</p><p>Here we show some of them, but check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/JmeterDsl.java" target="_blank" rel="noopener noreferrer">JmeterDsl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/http/DslHttpSampler.java" target="_blank" rel="noopener noreferrer">DslHttpSampler<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to explore all available features.</p><h4 id="methods-body" tabindex="-1"><a class="header-anchor" href="#methods-body" aria-hidden="true">#</a> Methods &amp; body</h4><p>As previously seen, you can do simple gets and posts like in the following snippet:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span> <span class="token comment">// A simple get</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;field\&quot;:\&quot;val\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span> <span class="token comment">// simple post</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>But you can also use additional methods to specify any HTTP method and body:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;field\&quot;:\&quot;val\&quot;}&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Additionally, when in need to generate dynamic URLs or bodies, you can use lambda expressions (as previously seen in some examples):</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">TEXT_PLAIN</span><span class="token punctuation">)</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestUrl</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// buildRequestUrl is just an example of a custom method you could implement with your own logic</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>As previously mentioned, even though using Java Lambdas has several benefits, they are also less portable. Check <a href="#lambdas">this section</a> for more details.</p></div><h4 id="parameters" tabindex="-1"><a class="header-anchor" href="#parameters" aria-hidden="true">#</a> Parameters</h4><p>In many cases, you will need to specify some URL query string parameters or URL encoded form bodies. For these cases, you can use <code>param</code> method as in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HTTPConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> baseUrl <span class="token operator">=</span> <span class="token string">&quot;https://myservice.com/products&quot;</span><span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token comment">// GET https://myservice.com/products?name=iron+chair</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;GetIronChair&quot;</span><span class="token punctuation">,</span> baseUrl<span class="token punctuation">)</span> 
                <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iron chair&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">/*
             * POST https://myservice.com/products
             * Content-Type: application/x-www-form-urlencoded
             * 
             * name=wooden+chair
             */</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;CreateWoodenChair&quot;</span><span class="token punctuation">,</span> baseUrl<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span> <span class="token comment">// POST </span>
                <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wooden chair&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>JMeter automatically URL encodes parameters, so you don&#39;t need to worry about special characters in parameter names or values.</p><p>If you want to use some custom encoding or have an already encoded value that you want to use, then you can use <code>rawParam</code> method instead which does not apply any encoding to the parameter name or value, and send it as is.</p></div><h4 id="headers" tabindex="-1"><a class="header-anchor" href="#headers" aria-hidden="true">#</a> Headers</h4><p>You might have already noticed in some of the examples that we have shown already some ways to set some headers. For instance, in the following snippet <code>Content-Type</code> header is being set in two different ways:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;field\&quot;:\&quot;val\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>These are handy methods to specify the <code>Content-Type</code> header, but you can also set any header on a particular request using provided <code>header</code> method, like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-First-Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;val1&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-Second-Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;val2&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Additionally, you can specify headers to be used by all samplers in a test plan, thread group, transaction controllers, etc. For this you can use <code>httpHeaders</code> like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;val1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/users&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can also use lambda expressions for dynamically building HTTP Headers, but the same limitations apply as in other cases (running in BlazeMeter, OctoPerf, Azure, or using generated JMX file).</p></div><h4 id="authentication" tabindex="-1"><a class="header-anchor" href="#authentication" aria-hidden="true">#</a> Authentication</h4><p>When in need to authenticate user associated to an HTTP request you can either use <code>httpAuth</code> or custom logic (with HTTP headers, regex extractors, variables, and other potential elements) to properly generate the required requests.</p><p><code>httpAuth</code> greatly simplifies common scenarios like this example using basic auth:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> baseUrl <span class="token operator">=</span> <span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">;</span>
<span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">httpAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">basicAuth</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;AUTH_USER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;AUTH_PASSWORD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Even though you can specify an empty base URL to match any potential request, don&#39;t do it. Defining a non-specific enough base URL, may leak credentials to unexpected sites, for example, when used in combination with <code>downloadEmbeddedResources()</code>.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Avoid including credentials in repository where code is hosted, which might lead to security leaks.</p><p>In provided example credentials are obtained from environment variable that have to be predefined by user when running tests, but you can also use other approaches to avoid security leaks.</p><p>Also take into consideration that if you use <code>jtlWriter</code> and chose to store HTTP request headers and/or bodies, then JTL could include used credentials and might be also a potential source for security leaks.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Http Authorization Manager, the element used by <code>httpAuth</code>, automatically adds the <code>Authorization</code> header for each request that starts with the given base url. If you need more control (e.g.: only send the header in the first request or under certain condition), you might add <code>httpAuth</code> only to specific requests or just build custom logic through usage of <code>httpHeaders</code>, <code>regexExtractor</code> and <code>jsr223PreProcessor</code>.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Currently <code>httpAuth()</code> only provides <code>basicAuth</code> method. If you need other scenarios, please let us know by creating an <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">issue in the repository<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><p>You can check additional details in <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/http/DslAuthManager.java" target="_blank" rel="noopener noreferrer">DslAuthManager<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h4 id="multipart-requests" tabindex="-1"><a class="header-anchor" href="#multipart-requests" aria-hidden="true">#</a> Multipart requests</h4><p>When you need to upload files to an HTTP server or need to send a complex request body, you will in many cases require sending multipart requests. To send a multipart request just use <code>bodyPart</code> and <code>bodyFilePart</code> methods like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HTTPConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice.com/report&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HTTPConstants</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bodyPart</span><span class="token punctuation">(</span><span class="token string">&quot;myText&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">TEXT_PLAIN</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bodyFilePart</span><span class="token punctuation">(</span><span class="token string">&quot;myFile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;myReport.xml&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">TEXT_XML</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cookies-caching" tabindex="-1"><a class="header-anchor" href="#cookies-caching" aria-hidden="true">#</a> Cookies &amp; caching</h4><p>jmeter-java-dsl automatically adds a cookie manager and cache manager for automatic HTTP cookie and caching handling, emulating a browser behavior. If you need to disable them you can use something like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">httpCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">httpCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="timeouts" tabindex="-1"><a class="header-anchor" href="#timeouts" aria-hidden="true">#</a> Timeouts</h4><p>By default, JMeter uses system default configurations for connection and response timeouts (maximum time for a connection to be established or a server response after a request, before it fails). This is might make the test behave different depending on the machine where it runs. To avoid this, it is recommended to always set these values. Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">connectionTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">responseTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Currently we are using same defaults as JMeter to avoid breaking existing test plans executions, but in a future major version we plan to change default setting to avoid the common pitfall previously mentioned.</p></div><h4 id="connections" tabindex="-1"><a class="header-anchor" href="#connections" aria-hidden="true">#</a> Connections</h4><p>jmeter-java-dsl, as JMeter (and also K6), by default <strong>reuses HTTP connections between thread iterations</strong> to avoid common issues with port and file descriptors exhaustion which require manual OS tuning and may manifest in many ways.</p><p>This decision implies that the load generated from 10 threads and 100 iterations is not the same as the one generated by 1000 real users with up to 10 concurrent users in a given time, since the load imposed by each user connection and disconnection would only be generated once for each thread.</p><p>If you need for each iteration to reset connections you can use something like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">resetConnectionsBetweenIterations</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>If you use this setting you might want to take a look at &quot;Config your environment&quot; section of <a href="https://medium.com/@chientranthien/how-to-generate-high-load-benchmark-with-jmeter-80e828a67592" target="_blank" rel="noopener noreferrer">this article<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to avoid port and file descriptors exhaustion.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Connections are configured by default with a TTL (time-to-live) of 1 minute, which you can easily change like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">connectionTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>This and <code>resetConnectionsBetweenIterations</code> apply at the JVM level (due to JMeter limitation), so they affect all requests in the test plan and other ones potentially running in the same JVM instance.</li></ul></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Using <code>clientImpl(HttpClientImpl.JAVA)</code> will ignore any of the previous settings and will reuse connections depending on JVM implementation.</p></div><h4 id="embedded-resources" tabindex="-1"><a class="header-anchor" href="#embedded-resources" aria-hidden="true">#</a> Embedded resources</h4><p>Sometimes you may need to reproduce a browser behavior, downloading for a given URL all associated resources (images, frames, etc.).</p><p>jmeter-java-dsl allows you to easily reproduce this scenario by using the <code>downloadEmbeddedResources</code> method in <code>httpSampler</code> like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">downloadEmbeddedResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will make JMeter automatically parse the HTTP response for embedded resources, download them and register embedded resources downloads as sub-samples of the main sample.</p><p>Check <a href="https://jmeter.apache.org/usermanual/component_reference.html#HTTP_Request" target="_blank" rel="noopener noreferrer">JMeter documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional details on downloaded embedded resources.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can use <code>downloadEmbeddedResourcesNotMatching(urlRegex)</code> and <code>downloadEmbeddedResourcesMatching(urlRegex)</code> methods if you need to ignore, or only download, some embedded resources requests. For example, when some requests are not related to the system under test.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>The DSL, unlike JMeter, uses by default concurrent download of embedded resources (with up to 6 parallel downloads), which is the most used scenario to emulate browser behavior.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Using <code>downloadEmbeddedResources</code> doesn&#39;t allow to download all resources that a browser could download, since it does not execute any JavaScript. For instance, resources URLs solved through JavaScript or direct JavaScript requests will not be requested. Even with this limitation, in many cases just downloading &quot;static&quot; resources is a good enough solution for performance testing.</p></div><h4 id="redirects" tabindex="-1"><a class="header-anchor" href="#redirects" aria-hidden="true">#</a> Redirects</h4><p>When jmeter-java-dsl (using JMeter logic) detects a redirection, it will automatically do a request to the redirected URL and register the redirection as a sub-sample of the main request.</p><p>If you want to disable such logic, you can just call <code>.followRedirects(false)</code> in a given <code>httpSampler</code>.</p><h4 id="keep-alive" tabindex="-1"><a class="header-anchor" href="#keep-alive" aria-hidden="true">#</a> Keep alive</h4><p>By default, <strong>JMeter Java DSL</strong> uses a persistent HTTP connection (sending the <code>Connection: keep-alive</code> header) to reuse the same socket for multiple requests to the same server.</p><p>To force server to close the connection after each request, you can disable keep-alive with <code>.useKeepAlive(false)</code> either on an individual <code>httpSampler</code> or globally on <code>httpDefaults</code>.</p><p>This can be useful when you’re load-testing an API that enforces a strict limit on the number of simultaneous sockets per client. If you leave keep-alive enabled, each thread will hold its socket open for the duration of the test, consuming the server&#39;s connection resources.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token comment">//Disable keep-alive for this sampler: sends Connection: close header and close the connection after this request</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice1.com&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">useKeepAlive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// Explicitly enable keep-alive for this sampler: sends Connection: keep-alive header and keeps the connection open</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice2.com&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">useKeepAlive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">//No keep-alive configuration, so it will use the default keep-alive behavior (keep-alive enabled)</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice3.com&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>      
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token comment">//Disable keep-alive globally for all samplers in this test plan</span>
        <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">useKeepAlive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token comment">// These samplers inherit keep-alive disabled from httpDefaults()</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice1.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice2.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// Explicitly enable keep-alive for this sampler overriding the global setting</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice3.com&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">useKeepAlive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
       <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="http-defaults" tabindex="-1"><a class="header-anchor" href="#http-defaults" aria-hidden="true">#</a> HTTP defaults</h4><p>Whenever you need to use some repetitive value or common setting among HTTP samplers (and any part of the test plan) the preferred way (due to readability, debugability, traceability, and in some cases simplicity) is to create a Java variable or custom builder method.</p><p>For example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">DslHttpSampler</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">performanceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;myservice.my&quot;</span><span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span>
            <span class="token function">productCreatorSampler</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token string">&quot;Rubber&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">productCreatorSampler</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token string">&quot;Pencil&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token class-name">DslHttpSampler</span> <span class="token function">productCreatorSampler</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">,</span> <span class="token class-name">String</span> productName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://&quot;</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">&quot;/api/product&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;&quot;</span> <span class="token operator">+</span> productName <span class="token operator">+</span> <span class="token string">&quot;\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In some cases though, it might be simpler to just use provided <code>httpDefaults</code> method, like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">performanceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice.my&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">downloadEmbeddedResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/cart&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/http/DslHttpDefaults.java" target="_blank" rel="noopener noreferrer">DslHttpDefaults<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional details on available default options.</p><h4 id="overriding-url-protocol-host-or-port" tabindex="-1"><a class="header-anchor" href="#overriding-url-protocol-host-or-port" aria-hidden="true">#</a> Overriding URL protocol, host or port</h4><p>In some cases, you might want to use a default base URL but some particular requests may require some part of the URL to be different (eg: protocol, host, or port).</p><p>The preferred way (due to maintainability, language &amp; IDE provided features, traceability, etc) of doing this, as with defaults, is using java code. Eg:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> protocol <span class="token operator">=</span> <span class="token string">&quot;https://&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;myservice.com&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> baseUrl <span class="token operator">=</span> protocol <span class="token operator">+</span> host<span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span>protocol <span class="token operator">+</span> <span class="token string">&quot;api.&quot;</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">&quot;/cart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/stores&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>But in some cases, this might be too verbose, or unnatural for users with existing JMeter knowledge. In such cases you can use provided methods (<code>protocol</code>, <code>host</code> &amp; <code>port</code>) to just specify the part you want to modify for the sampler like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/cart&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;subDomain.myservice.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;/stores&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="proxy" tabindex="-1"><a class="header-anchor" href="#proxy" aria-hidden="true">#</a> Proxy</h4><p>Sometimes, due to company policies, some infrastructure requirement or just to further analyze or customize requests, for example, through the usage of tools like <a href="https://www.telerik.com/fiddler" target="_blank" rel="noopener noreferrer">fiddler<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://mitmproxy.org/" target="_blank" rel="noopener noreferrer">mitmproxy<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, you need to specify a proxy server through which HTTP requests are sent to their final destination. This can be easily done with <code>proxy</code> method, like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice.com&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">&quot;http://myproxy:8081&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can also specify proxy authentication parameters with <code>proxy(url, username, password)</code> method.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When you need to set a proxy for several samplers, use <code>httpDefaults().proxy</code> methods.</p></div><h3 id="graphql" tabindex="-1"><a class="header-anchor" href="#graphql" aria-hidden="true">#</a> GraphQL</h3><p>When you want to test a GraphQL service, having properly set each field in an HTTP request and knowing the exact syntax for each of them, can quickly start becoming tedious. For this purpose, jmeter-java-dsl provides <code>graphqlSampler</code>. To use it you need to include this dependency:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-graphql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-graphql:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And then you can make simple GraphQL requests like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>graphql<span class="token punctuation">.</span></span><span class="token class-name">DslGraphqlSampler</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;https://myservice.com&quot;</span><span class="token punctuation">;</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">graphqlSampler</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;{user(id: 1) {name}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">graphqlSampler</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;query UserQuery($id: Int) { user(id: $id) {name}}&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">operationName</span><span class="token punctuation">(</span><span class="token string">&quot;UserQuery&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">variable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>GraphQL Sampler is based on HTTP Sampler, so all test elements that affect HTTP Samplers, like <code>httpHeaders</code>, <code>httpCookies</code>, <code>httpDefaults</code>, and JMeter properties, also affect GraphQL sampler.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>grapqlSampler</code> sets by default <code>application/json</code> <code>Content-Type</code> header.</p><p>This has been done to ease the most common use cases and to avoid users the common pitfall of missing the proper <code>Content-Type</code> header value.</p><p>If you need to modify <code>graphqlSampler</code> content type to be other than <code>application/json</code>, then you can use <code>contentType</code> method, potentially parameterizing it to reuse the same value in multiple samplers like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>graphql<span class="token punctuation">.</span></span><span class="token class-name">DslGraphqlSampler</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>graphql<span class="token punctuation">.</span></span><span class="token class-name">DslGraphqlSampler</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">DslGraphqlSampler</span> <span class="token function">myGraphqlRequest</span><span class="token punctuation">(</span><span class="token class-name">String</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">graphqlSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://myservice.com&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;myContentType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">myGraphqlRequest</span><span class="token punctuation">(</span><span class="token string">&quot;{user(id: 1) {name}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">myGraphqlRequest</span><span class="token punctuation">(</span><span class="token string">&quot;{user(id: 5) {address}}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h3 id="jdbc-and-databases-interactions" tabindex="-1"><a class="header-anchor" href="#jdbc-and-databases-interactions" aria-hidden="true">#</a> JDBC and databases interactions</h3><p>Several times you will need to interact with a database to either set it to a known state while setting up the test plan, clean it up while tearing down the test plan, or even check or generate some values in the database while the test plan is running.</p><p>For these use cases, you can use JDBC DSL-provided elements.</p><p>Including the following dependency in your project:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-jdbc:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And adding a proper JDBC driver for your database, like this example for PostgreSQL:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.postgresql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>postgresql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>42.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;org.postgresql:postgresql:42.3.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>You can interact with the database like this:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">JdbcJmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Types</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">ContentType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>postgresql<span class="token punctuation">.</span></span><span class="token class-name">Driver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DslJdbcSampler</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> jdbcPoolName <span class="token operator">=</span> <span class="token string">&quot;pgLocalPool&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> productName <span class="token operator">=</span> <span class="token string">&quot;dsltest-prod&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">DslJdbcSampler</span> cleanUpSampler <span class="token operator">=</span> <span class="token function">jdbcSampler</span><span class="token punctuation">(</span>jdbcPoolName<span class="token punctuation">,</span>
        <span class="token string">&quot;DELETE FROM products WHERE name = &#39;&quot;</span> <span class="token operator">+</span> productName <span class="token operator">+</span> <span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">jdbcConnectionPool</span><span class="token punctuation">(</span>jdbcPoolName<span class="token punctuation">,</span> <span class="token class-name">Driver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;jdbc:postgresql://localhost/my_db&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;pass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">setupThreadGroup</span><span class="token punctuation">(</span>
            cleanUpSampler
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;CreateProduct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://my.service/products&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;, \&quot;&quot;</span> <span class="token operator">+</span> productName <span class="token operator">+</span> <span class="token string">&quot;\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ContentType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">jdbcSampler</span><span class="token punctuation">(</span><span class="token string">&quot;GetProductsIdsByName&quot;</span><span class="token punctuation">,</span> jdbcPoolName<span class="token punctuation">,</span>
                <span class="token string">&quot;SELECT id FROM products WHERE name=?&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span>productName<span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">VARCHAR</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">vars</span><span class="token punctuation">(</span><span class="token string">&quot;PRODUCT_ID&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;GetLatestProduct&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;http://my.service/products/${__V(PRODUCT_ID_${PRODUCT_ID_#})}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">teardownThreadGroup</span><span class="token punctuation">(</span>
            cleanUpSampler
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Always specify a query timeout to quickly identify unexpected behaviors in queries.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Don&#39;t forget proper <code>WHERE</code> conditions in <code>UPDATES</code> and <code>DELETES</code>, and proper indexes for table columns participating in <code>WHERE</code> conditions 😊.</p></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-jdbc/src/main/java/us/abstracta/jmeter/javadsl/jdbc/JdbcJmeterDsl.java" target="_blank" rel="noopener noreferrer">JdbcJmeterDsl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional details and options and <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-jdbc/src/test/java/us/abstracta/jmeter/javadsl/jdbc/JdbcJmeterDslTest.java" target="_blank" rel="noopener noreferrer">JdbcJmeterDslTest<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for additional examples.</p><h3 id="java-api-performance-testing" tabindex="-1"><a class="header-anchor" href="#java-api-performance-testing" aria-hidden="true">#</a> Java API performance testing</h3><p>Sometimes JMeter provided samplers are not enough for testing a particular technology, custom code, or service that requires some custom code to interact with. For these cases, you might use <code>jsr223Sampler</code> which allows you to use custom logic to generate a sample result.</p><p>Here is an example for load testing a Redis server:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestRedis</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldGetExpectedSampleResultWhenJsr223SamplerWithLambdaAndCustomResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">jsr223Sampler</span><span class="token punctuation">(</span><span class="token string">&quot;import redis.clients.jedis.Jedis\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;Jedis jedis = new Jedis(&#39;localhost&#39;, 6379)\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;jedis.connect()\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;SampleResult.connectEnd()\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;jedis.set(&#39;foo&#39;, &#39;bar&#39;)\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;return jedis.get(\&quot;foo\&quot;)&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Remember to add any particular dependencies required by your code. For example, the above example requires this dependency:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;redis.clients:jedis:3.6.0&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div></div><p>You can also use Java lambdas instead of Groovy script to take advantage of IDEs auto-completion, Java type safety, and less CPU consumption:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">jsr223Sampler</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">SampleResult</span> result <span class="token operator">=</span> v<span class="token punctuation">.</span>sampleResult<span class="token punctuation">;</span>
    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jedis<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">connectEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">setResponseData</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>As previously mentioned, even though using Java Lambdas has several benefits, they are also less portable. Check <a href="#lambdas">this section</a> for more details.</p></div><p>You may even use some custom logic that executes a particular logic when a thread group thread is created and finished. Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestRedis</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">RedisSampler</span> <span class="token keyword">implements</span> <span class="token class-name">SamplerScript</span><span class="token punctuation">,</span> <span class="token class-name">ThreadListener</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Jedis</span> jedis<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">threadStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      jedis<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runScript</span><span class="token punctuation">(</span><span class="token class-name">SamplerVars</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      v<span class="token punctuation">.</span>sampleResult<span class="token punctuation">.</span><span class="token function">setResponseData</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">threadFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldGetExpectedSampleResultWhenJsr223SamplerWithLambdaAndCustomResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">jsr223Sampler</span><span class="token punctuation">(</span><span class="token class-name">RedisSampler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You can also make your class implement <code>TestIterationListener</code> to execute custom logic on each thread group iteration start, or <code>LoopIterationListener</code> to execute some custom logic on each iteration start (for example, each iteration of a <code>forLoop</code>).</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When using public static classes in <code>jsr223Sampler</code> take into consideration that one instance of the class is created for each thread group thread and <code>jsr223Sampler</code> instance.</p></div><p><strong>Note:</strong> <code>jsr223Sampler</code> is very powerful, but also makes code and test plans harder to maintain (as with any custom code) compared to using JMeter built-in samplers. So, in general, prefer using JMeter-provided samplers if they are enough for the task at hand, and use <code>jsr223Sampler</code> sparingly.</p><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/java/DslJsr223Sampler.java" target="_blank" rel="noopener noreferrer">DslJsr223Sampler<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details and additional options.</p><h3 id="selenium" tabindex="-1"><a class="header-anchor" href="#selenium" aria-hidden="true">#</a> Selenium</h3><p>With JMeter DSL is quite simple to integrate your existing selenium scripts into performance tests. One common use case is to do real user monitoring or synthetics monitoring (get time spent in particular parts of a Selenium script) while the backend load is being generated.</p><p>Here is an example of how you can do this with JMeter DSL:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SeleniumSampler</span> <span class="token keyword">implements</span> <span class="token class-name">SamplerScript</span><span class="token punctuation">,</span> <span class="token class-name">ThreadListener</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">WebDriver</span> driver<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">threadStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      driver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChromeDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// you can invoke existing set up logic to reuse it</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runScript</span><span class="token punctuation">(</span><span class="token class-name">SamplerVars</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      driver<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;https://mysite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// you can invoke existing selenium script for reuse here</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">threadFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      driver<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// you can invoke existing tear down logic to reuse it</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldGetExpectedSampleResultWhenJsr223SamplerWithLambdaAndCustomResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Duration</span> testPlanDuration <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> testPlanDuration<span class="token punctuation">,</span>
            <span class="token function">jsr223Sampler</span><span class="token punctuation">(</span><span class="token string">&quot;Real User Monitor&quot;</span><span class="token punctuation">,</span> <span class="token class-name">SeleniumSampler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> testPlanDuration<span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;https://mysite/products&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;test\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="#java-api-performance-testing">previous section</a> for more details on <code>jsr223Sampler</code>.</p><h2 id="custom-or-yet-not-supported-test-elements" tabindex="-1"><a class="header-anchor" href="#custom-or-yet-not-supported-test-elements" aria-hidden="true">#</a> Custom or yet not supported test elements</h2><p>Whenever you find some JMeter test element or feature that is not yet supported by the DSL, <strong>we strongly encourage you to request it as an issue <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong> or even contribute it to the DSL (check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">Contributing guide<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>) so the entire community can benefit from it.</p><p>In some cases though, you might have some private custom test element that you don&#39;t want to publish or share with the rest of the community, or you are just really in a hurry and want to use it while the proper support is included in the DSL.</p><p>For such cases, the preferred approach is implementing a builder class for the test element. Eg:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>testelement<span class="token punctuation">.</span></span><span class="token class-name">TestElement</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>samplers<span class="token punctuation">.</span></span><span class="token class-name">BaseSampler</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DslCustomSampler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseSampler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DslCustomSampler</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">String</span> myProp<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token class-name">DslCustomSampler</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token class-name">CustomSamplerGui</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// you can pass null here if custom sampler is a test bean</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">DslCustomSampler</span> <span class="token function">myProp</span><span class="token punctuation">(</span><span class="token class-name">String</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myProp <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token class-name">TestElement</span> <span class="token function">buildTestElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CustomSampler</span> ret <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomSampler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">setMyProp</span><span class="token punctuation">(</span>myProp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DslCustomSampler</span> <span class="token function">customSampler</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DslCustomSampler</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Which you can use as any other JMeter DSL component, like in this example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">DslCustomSampler</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">customSampler</span><span class="token punctuation">(</span><span class="token string">&quot;mySampler&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">myProp</span><span class="token punctuation">(</span><span class="token string">&quot;myVal&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This approach allows for easy reuse, compact and simple usage in tests, and you might even create your own <code>CustomJmeterDsl</code> class containing builder methods for many custom components.</p><p>Alternatively, when you want to skip creating subclasses, you might use the DSL wrapper module.</p><p>Include the module on your project:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Maven</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Gradle</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-wrapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>testImplementation <span class="token string">&#39;us.abstracta.jmeter:jmeter-java-dsl-wrapper:2.1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>And use a wrapper like in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span></span><span class="token class-name">WrapperJmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function">testElement</span><span class="token punctuation">(</span><span class="token string">&quot;mySampler&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CustomSamplerGui</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// for test beans you can just provide the test bean instance</span>
                <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&quot;myProp&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;myVal&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-wrapper/src/main/java/us/abstracta/jmeter/javadsl/wrapper/WrapperJmeterDsl.java" target="_blank" rel="noopener noreferrer">WrapperJmeterDsl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details and additional wrappers.</p><h2 id="jmx-support" tabindex="-1"><a class="header-anchor" href="#jmx-support" aria-hidden="true">#</a> JMX support</h2><h3 id="save-as-jmx" tabindex="-1"><a class="header-anchor" href="#save-as-jmx" aria-hidden="true">#</a> Save as JMX</h3><p>In case you want to load a test plan in JMeter GUI, you can save it just invoking <code>saveAsJMX</code> method in the test plan as in the following example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaveTestPlanAsJMX</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">saveAsJmx</span><span class="token punctuation">(</span><span class="token string">&quot;dsl-test-plan.jmx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This can be helpful to share a Java DSL defined test plan with people not used to the DSL or to use some JMeter feature (or plugin) that is not yet supported by the DSL (<strong>but, we strongly encourage you to report it as an issue <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong> so we can include such support into the DSL for the rest of the community).</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you get any error (like <code>CannotResolveClassException</code>) while loading the JMX in JMeter GUI, you can try copying <code>jmeter-java-dsl</code> jar (and any other potential modules you use) to JMeter <code>lib</code> directory, restart JMeter and try loading the JMX again.</p></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you want to migrate changes done in JMX to the Java DSL, you can use <a href="#dsl-code-generation-from-jmx-file">jmx2dsl</a> as an accelerator. The resulting plan might differ from the original one, so sometimes it makes sense to use it, and some it is faster just to port the changes manually.</p></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>If you use JSR223 Pre- or Post-processors with Java code (lambdas) instead of strings or use one of the HTTP Sampler methods which receive a function as a parameter, then the exported JMX will not work in JMeter GUI. You can migrate them to use jsrPreProcessor with string scripts instead.</p></div><h3 id="run-jmx-file" tabindex="-1"><a class="header-anchor" href="#run-jmx-file" aria-hidden="true">#</a> Run JMX file</h3><p>jmeter-java-dsl also provides means to easily run a test plan from a JMX file either locally, in BlazeMeter (through <a href="#blazemeter">previously mentioned jmeter-java-dsl-blazemeter module</a>), OctoPerf (through <a href="#octoperf">jmeter-java-dsl-octoperf module</a>), or Azure Load testing (through <a href="#azure-load-testing">jmeter-java-dsl-azure module</a>). Here is an example:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertThat</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">DslTestPlan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunJmxTestPlan</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token class-name">DslTestPlan</span><span class="token punctuation">.</span><span class="token function">fromJmx</span><span class="token punctuation">(</span><span class="token string">&quot;test-plan.jmx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This can be used to just run existing JMX files, or when DSL has no support for some JMeter functionality or plugin (although you can use <a href="#custom-or-yet-not-supported-test-elements">wrappers</a> for this), and you need to use JMeter GUI to build the test plan but still want to use jmeter-java-dsl to run the test plan embedded in Java test or code.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When the JMX uses some custom plugin or JMeter protocol support, you might need to add required dependencies to be able to run the test in an embedded engine. For example, when running a TN3270 JMX test plan using RTE plugin you will need to add the following repository and dependencies:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>jitpack.io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://jitpack.io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.Blazemeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>RTEPlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.Blazemeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dm3270<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.12.3-lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/jmeter-java-dsl/assets/app-0b55935c.js" defer></script>
  </body>
</html>
